<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Psyche Panacea - Corporate Training Solutions</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="/images/psypan-logo-transparent.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Include Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0052cc',
            secondary: '#4da8ff',
            dark: '#1a1a1a',
            light: '#f8f9fa',
            accent: '#f59e0b'
          },
          fontFamily: {
            poppins: ['Poppins', 'sans-serif']
          },
          animation: {
            'marquee': 'marquee 25s linear infinite',
            'fadeIn': 'fadeIn 1s ease-in',
            'slideUp': 'slideUp 0.8s ease-out',
            'fadeZoom': 'fadeZoom 2s infinite'
          },
          keyframes: {
            marquee: {
              '0%': { transform: 'translateX(0)' },
              '100%': { transform: 'translateX(-100%)' }
            },
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' }
            },
            slideUp: {
              '0%': { transform: 'translateY(30px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' }
            },
            fadeZoom: {
              '0%, 100%': { opacity: '0.5', transform: 'scale(0.9)' },
              '50%': { opacity: '1', transform: 'scale(1.1)' }
            }
          }
        }
      }
    }
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans', sans-serif;
      background: linear-gradient(to bottom, #ffffff, #f0f9ff);
      color: #334155;
      overflow-x: hidden;
    }

    .hero-pattern {
      background: radial-gradient(circle, rgba(30, 64, 175, 0.05) 0%, rgba(255, 255, 255, 0) 70%);
    }

    .card-hover {
      transition: all 0.3s ease;
    }

    .card-hover:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .testimonial-card {
      background: linear-gradient(145deg, #ffffff, #f8fafc);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
    }

    .logo-marquee {
      display: flex;
      width: 200%;
      animation: marquee 25s linear infinite;
    }

    .logo-item {
      flex: 0 0 auto;
      margin: 0 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.7;
      transition: opacity 0.3s;
    }

    .logo-item:hover {
      opacity: 1;
    }

    .footer-links a {
      position: relative;
    }

    .footer-links a:after {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      width: 0;
      height: 1px;
      background: white;
      transition: width 0.3s ease;
    }

    .footer-links a:hover:after {
      width: 100%;
    }

    .animate-on-scroll {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }

    .animate-on-scroll.active {
      opacity: 1;
      transform: translateY(0);
    }

    .slideshow-container {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-position: center;
      opacity: 0;
      animation: slideShow 15s infinite;
    }

    .slide:nth-child(1) {
      animation-delay: 0s;
    }

    .slide:nth-child(2) {
      animation-delay: 3s;
    }

    .slide:nth-child(3) {
      animation-delay: 6s;
    }

    .slide:nth-child(4) {
      animation-delay: 9s;
    }

    .slide:nth-child(5) {
      animation-delay: 12s;
    }

    /* Fixed navbar solution */
    header {
      background-color: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      position: fixed;
      top: 0;
      width: 100%;
      height: 12vh;
      z-index: 1000;
      padding: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    nav a {
      position: relative;
      transition: color 0.3s ease;
    }

    nav a::after {
      content: '';
      position: absolute;
      width: 0;
      height: 2px;
      bottom: -4px;
      left: 0;
      background-color: #0052cc;
      transition: width 0.3s ease;
    }

    nav a:hover::after {
      width: 100%;
    }

    .active-nav-link {
      color: #0052cc;
      font-weight: 600;
    }

    .active-nav-link::after {
      width: 100%;
    }

    @keyframes slideShow {
      0% {
        opacity: 0;
        transform: scale(1.05);
      }

      10% {
        opacity: 1;
        transform: scale(1);
      }

      20% {
        opacity: 1;
      }

      30% {
        opacity: 0;
      }

      100% {
        opacity: 0;
      }
    }

    .typing-animation {
      overflow: hidden;
      border-right: .15em solid #3b82f6;
      white-space: nowrap;
      animation: typing 1s steps(40, end), blink-caret .75s step-end infinite;
    }

    .bot-typing .bot-typing-text {
      border-right: .15em solid #3b82f6;
      white-space: pre-wrap;
      /* allow wrapped typed text */
      display: inline-block;
      animation: blink-caret .75s step-end infinite;
    }

    @keyframes typing {
      from {
        width: 0
      }

      to {
        width: 100%
      }
    }

    @keyframes blink-caret {

      from,
      to {
        border-color: transparent
      }

      50% {
        border-color: #3b82f6;
      }
    }

    .chatbot-body {
      scroll-behavior: smooth;
      height: 250px;
    }

    #chatbotWindow {
      transition: all 0.3s ease;
    }

    .option-btn {
      transition: all 0.2s ease;
    }

    .option-btn:hover {
      transform: translateY(-2px);
    }

    #chatbotToggle {
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
      transition: all 0.3s ease;
    }

    #chatbotToggle:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
    }

    .chatbot-message {
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @media (max-width: 480px) {
      .chatbot-window {
        width: 90vw;
        max-width: 90vw;
        right: 5px;
        max-height: 50vh;
      }

      .chatbot-input {
        padding: 0.5rem;
      }

      .chatbot-input input {
        padding: 0.5rem;
      }

      .chatbot-toggle {
        width: 50px;
        height: 50px;
      }
    }

    /* Map container */
    .map-container {
      height: 300px;
    }

    /* Mobile menu fixes */
    #mobile-menu {
      position: fixed;
      left: 0;
      right: 0;
      top: 20px;
      background: white;
      z-index: 1001;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      /* Start hidden */
    }

    /* Mobile menu visible */
    #mobile-menu.active {
      display: block;
    }

    /* Mobile menu links */
    #mobile-menu a {
      display: block;
      padding: 12px 20px;
      color: #333;
      text-decoration: none;
      border-bottom: 1px solid #eee;
      transition: background 0.3s;
    }

    #mobile-menu a:hover {
      background-color: #f0f7ff;
    }

    /* Active link in mobile menu */
    #mobile-menu a.active {
      background-color: #e6f2ff;
      color: #0052cc;
    }

    /* 1) Container hides the overflow */
    .logo-slider {
      position: relative;
      overflow: hidden;
    }

    /* 2) Track flexes its children in one row and animates */
    .logo-track {
      display: flex;
      /* make sure the total length is twice the viewport so 50% translation lines up */
      width: max-content;
      animation: scroll-logotrack 20s linear infinite;
    }

    /* 3) Pause on hover */
    .logo-slider:hover .logo-track {
      animation-play-state: paused;
    }

    /* 4) Keyframes: shift left by exactly half of the track (your duplicated set) */
    @keyframes scroll-logotrack {
      from {
        transform: translateX(0);
      }

      to {
        transform: translateX(-50%);
      }
    }

    /* wrap your card so the overflow is clipped during the slide */
    .testimonial-card {
      position: relative;
      overflow: hidden;
    }

    /* slide in from right */
    @keyframes slideInFromRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* slide in from left */
    @keyframes slideInFromLeft {
      from {
        transform: translateX(-100%);
        opacity: 0;
      }

      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* utility classes */
    .slide-in-right {
      animation: slideInFromRight 0.5s ease-out both;
    }

    .slide-in-left {
      animation: slideInFromLeft 0.5s ease-out both;
    }

    @keyframes pop {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.2);
      }

      100% {
        transform: scale(1);
      }
    }

    .pop {
      animation: pop 2s ease-in-out;
    }

    /* --- Flip card core --- */
    .flip-card {
      perspective: 1200px;
      -webkit-perspective: 1200px;
      position: relative;
      /* for absolute faces */
      min-height: 240px;
      /* ensures card has height so absolute faces render */
      border-radius: 0.75rem;
      /* matches rounded-xl */
      overflow: visible;
      /* allow shadows */
      transition: transform 0.25s ease, box-shadow 0.25s ease;
    }

    /* Outer hover lift (keeps your original hover lift) */
    .flip-card:hover,
    .flip-card:focus-within {
      transform: translateY(-8px) scale(1.02);
      box-shadow: 0 16px 40px rgba(2, 6, 23, 0.12);
    }

    .flip-card-inner {
      position: relative;
      height: 100%;
      transform-style: preserve-3d;
      -webkit-transform-style: preserve-3d;
      transition: transform 0.7s cubic-bezier(.2, .8, .2, 1);
      will-change: transform;
    }

    /* flip on hover/focus-within OR when .is-flipped is present (JS toggle) */
    .flip-card:hover .flip-card-inner,
    .flip-card:focus-within .flip-card-inner,
    .flip-card.is-flipped .flip-card-inner {
      transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
    }

    /* Faces — use absolute so they overlap; inset:0 fills parent */
    .flip-card-front,
    .flip-card-back {
      position: absolute;
      inset: 0;
      /* top:0; right:0; bottom:0; left:0; */
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      /* we'll align content inside */
      justify-content: center;
      padding: 1.5rem;
      /* matches your p-6 */
      box-sizing: border-box;
      border-radius: 0.75rem;
      background: white;
    }

    /* front stays as-is */
    .flip-card-front {
      transform: rotateY(0deg);
      z-index: 2;
    }

    /* back rotated 180 so it reads correctly after flip */
    .flip-card-back {
      transform: rotateY(180deg);
      -webkit-transform: rotateY(180deg);
    }

    /* small style niceties for back content */
    .card-back-inner {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    /* Keep reduced motion preference in mind */
    @media (prefers-reduced-motion: reduce) {
      .flip-card-inner {
        transition: none !important;
      }

      .flip-card {
        transition: none !important;
      }
    }

    /* Responsive tweak: increase min height on larger screens if needed */
    @media (min-width: 768px) {
      .flip-card {
        min-height: 260px;
      }
    }

    /* Custom styles for the animated carousel */
    .logo-slider {
      --gap: 1rem;
    }

    /* control spacing */
    .logo-track {
      gap: var(--gap);
      will-change: transform;
      transition: transform 600ms cubic-bezier(.22, .9, .35, 1);
      align-items: center;
      display: flex;
      padding: 0 1rem;
    }

    .client-logo {
      flex-shrink: 0;
      width: 10rem;
      /* matches w-40 from Tailwind */
      height: 5rem;
      /* matches h-20 from Tailwind */
      border-radius: 0.75rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background: white;
      box-shadow: 0 8px 22px rgba(2, 6, 23, 0.06);
      margin: 0 .5rem;
      /* small horizontal gap (mx-4 ~ 1rem total) */
      transform-origin: center;
      transition: transform 420ms cubic-bezier(.22, .9, .35, 1), opacity 300ms;
    }

    /* Centered item scale + prominence */
    .client-logo.is-center {
      transform: scale(1.12);
      z-index: 5;
      opacity: 1;
    }

    /* Non-centered logos slightly dimmed */
    .client-logo.dimmed {
      opacity: 0.55;
      transform: scale(0.98);
      z-index: 1;
    }

    /* smooth image fit */
    .client-logo img {
      max-height: 3.75rem;
      /* ~max-h-16 */
      max-width: 100%;
      object-fit: contain;
      display: block;
    }

    /* Prevent text selection while dragging or clicking */
    .logo-slider,
    .logo-track,
    .client-logo {
      user-select: none;
      -webkit-user-select: none;
      -ms-user-select: none;
    }

    /* Small responsive tweak */
    @media (max-width: 640px) {
      .client-logo {
        width: 7.5rem;
        height: 4rem;
      }

      .client-logo img {
        max-height: 3rem;
      }
    }

    .stats-value {
      font-size: 3rem;
      font-weight: bold;
      color: white;
      margin-bottom: 0.5rem;
    }

    .stats-label {
      font-size: 1.5rem;
      font-weight: bold;
      color: rgba(255, 255, 255, 0.9);
    }

    /* small extras — keeps your .stats-value class intact and adds a subtle scale while counting */
    .stats-value {
      will-change: transform, opacity;
      display: inline-block;
    }

    .stats-value.counting {
      transform: scale(1.04);
      transition: transform 1ms ease;
    }


    /* ---------------------------
  Review form — visual design
  --------------------------- */

    /* color tokens (override to match your theme) */
    :root {
      --bg-card: #ffffff;
      --muted: #6b7280;
      --primary: #0ea5a4;
      /* adjust to match .bg-primary */
      --primary-dark: #089090;
      --accent: #06b6d4;
      --success: #16a34a;
      --shadow: 0 10px 30px rgba(2, 6, 23, 0.08);
      --glass: rgba(255, 255, 255, 0.6);
    }

    /* Form card */
    #reviewForm {
      max-width: 720px;
      margin: 0 auto;
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.85), rgba(250, 250, 250, 0.82));
      border-radius: 14px;
      padding: 20px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(16, 24, 40, 0.04);
      backdrop-filter: blur(6px);
      transition: transform .22s ease, box-shadow .22s ease;
      will-change: transform;
    }

    /* Lift on hover for pointer devices */
    @media (hover: hover) {
      #reviewForm:hover {
        transform: translateY(-6px);
        box-shadow: 0 22px 60px rgba(2, 6, 23, 0.12);
      }
    }

    /* Form fields layout: keep vertical, but arrange some side-by-side on larger screens */
    #reviewForm>div {
      position: relative;
    }

    /* Labels */
    #reviewForm label {
      display: inline-block;
      font-weight: 600;
      color: #0f172a;
      /* dark */
      margin-bottom: 6px;
      font-size: 13px;
    }

    /* Inputs & textarea base */
    #reviewForm input[type="text"],
    #reviewForm input[type="email"],
    #reviewForm input[type="tel"],
    #reviewForm input[type="url"],
    #reviewForm textarea,
    #reviewForm select,
    #reviewForm input[type="file"] {
      width: 100%;
      background: #fff;
      border: 1px solid rgba(15, 23, 42, 0.06);
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(2, 6, 23, 0.04) inset;
      font-size: 14px;
      color: #0f172a;
      transition: box-shadow .18s ease, transform .12s ease, border-color .12s ease;
      outline: none;
    }

    /* Focus states */
    #reviewForm input:focus,
    #reviewForm textarea:focus,
    #reviewForm select:focus {
      box-shadow: 0 8px 26px rgba(6, 182, 212, 0.08);
      border-color: rgba(6, 182, 212, 0.28);
      transform: translateY(-1px);
    }

    /* Textarea */
    #reviewForm textarea {
      min-height: 110px;
      resize: vertical;
    }

    /* Two-column grouping for Name + Role + Rating on wider screens */
    @media (min-width: 720px) {
      #reviewForm {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 18px 24px;
        align-items: start;
      }

      /* make submit row span across both columns */
      #reviewForm>.full-row {
        grid-column: 1 / -1;
        display: flex;
        justify-content: flex-end;
        gap: 12px;
        align-items: center;
      }
    }

    /* File input — nicer native file button */
    #r-photo-file {
      padding: 8px 10px;
      background: linear-gradient(180deg, #ffffff, #f8fafc);
      border-radius: 10px;
    }

    /* Style the file selector button for modern browsers */
    #r-photo-file::file-selector-button {
      margin-right: 8px;
      border: none;
      background: var(--primary);
      color: #fff;
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: background .15s ease, transform .12s ease;
    }

    #r-photo-file::file-selector-button:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
    }

    /* Small preview placeholder (without JS you may still reserve space) */
    #r-photo-preview {
      width: 100%;
      height: 140px;
      border-radius: 10px;
      background: linear-gradient(180deg, #f8fafc, #ffffff);
      border: 1px dashed rgba(15, 23, 42, 0.06);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--muted);
      font-size: 13px;
      overflow: hidden;
    }

    /* Select control (rating) */
    #r-rating {
      width: 130px;
      background: linear-gradient(180deg, #fff, #fbfdff);
      text-align: left;
    }

    /* Buttons row adjustments (mobile fallback) */
    #reviewForm .flex {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    /* Primary submit button */
    #modalSubmit {
      background: linear-gradient(90deg, var(--primary), var(--accent));
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 10px;
      font-weight: 700;
      box-shadow: 0 10px 28px rgba(6, 182, 212, 0.12);
      cursor: pointer;
      transition: transform .12s ease, box-shadow .12s ease, opacity .12s ease;
    }

    #modalSubmit:hover {
      transform: translateY(-3px);
      box-shadow: 0 18px 48px rgba(6, 182, 212, 0.16);
    }

    #modalSubmit:active {
      transform: translateY(0);
    }

    /* Secondary cancel button */
    #modalCancel {
      background: transparent;
      border: 1px solid rgba(15, 23, 42, 0.06);
      padding: 8px 14px;
      border-radius: 10px;
      cursor: pointer;
      transition: background .12s ease, transform .12s ease;
    }

    #modalCancel:hover {
      background: #fafafa;
      transform: translateY(-2px);
    }

    /* Success / error message */
    #formMsg {
      font-weight: 600;
      color: var(--success);
      transition: opacity .18s ease, transform .12s ease;
    }

    #formMsg.hidden {
      opacity: 0;
      transform: translateY(-6px);
      pointer-events: none;
    }

    #formMsg.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* Tiny helper: improve label spacing inside grid layout */
    #reviewForm label+input,
    #reviewForm label+textarea,
    #reviewForm label+select,
    #reviewForm label+#r-photo-file {
      margin-top: 6px;
    }

    /* Accessibility: focus-visible ring */
    :focus-visible {
      outline: 3px solid rgba(6, 182, 212, 0.14);
      outline-offset: 2px;
    }

    /* Reduced motion preference */
    @media (prefers-reduced-motion: reduce) {

      #reviewForm,
      #modalSubmit,
      #modalCancel {
        transition: none !important;
        animation: none !important;
      }
    }

    /* Decorative micro-animations for input placeholders */
    #reviewForm input::placeholder,
    #reviewForm textarea::placeholder {
      color: rgba(15, 23, 42, 0.45);
    }

    /* Small screen adjustments — stack everything */
    @media (max-width: 719px) {
      #reviewForm {
        padding: 18px;
        display: block;
      }

      #reviewForm .flex {
        justify-content: space-between;
        align-items: center;
      }

      #modalSubmit,
      #modalCancel {
        padding: 10px 12px;
      }

      #r-rating {
        width: 100%;
        max-width: 220px;
      }

      /* ensure the file input is comfortable */
      #r-photo-file {
        padding: 8px;
      }
    }

    /* Optional: subtle input icon (if you later add) */
    .input-with-icon {
      position: relative;
    }

    .input-with-icon .icon {
      position: absolute;
      left: 10px;
      top: 50%;
      transform: translateY(-50%);
      pointer-events: none;
    }

    .input-with-icon input {
      padding-left: 34px;
    }

    /* Mobile responsiveness */
    @media (max-width: 640px) {

      /* Main title */
      #slide-container h1 {
        font-size: 2rem !important;
        /* smaller than 4rem */
        line-height: 2.5rem !important;
      }

      /* Service label text */
      #service-label {
        font-size: 1.25rem !important;
        /* smaller than 2rem */
      }

      /* Buttons */
      #slide-container a {
        font-size: 0.875rem;
        /* smaller text */
        padding: 0.5rem 1rem;
        /* reduce button padding */
      }

      /* Arrow buttons */
      #arrow-up,
      #arrow-down {
        width: 2.5rem;
        /* smaller */
        height: 2.5rem;
        font-size: 0.875rem;
      }
    }


    /* recent updates Container */
    .updates-section {
      background-color: #0052cc;
      height: 100%;
      width: 100%;
    }

    .updates-heading {
      text-align: center;
      margin-bottom: 1rem;
    }

    .updates-heading h2 {
      font-size: 2.2rem;
      font-weight: 700;
      color: #fff;
      display: inline-block;
      padding: 0.25rem 0.5rem;
      border-radius: 6px;
      animation: scalePulse 1.5s ease-in-out infinite;
    }

    /* small pulse for heading (optional) */
    @keyframes scalePulse {

      0%,
      100% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.25);
      }
    }

    /* Carousel area */
    .updates-carousel {
      position: relative;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      height: 550px;
      overflow: hidden;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(37, 99, 235, 0.12), rgba(30, 58, 138, 0.08));
      display: block;
      padding: 1.5rem;
      box-sizing: border-box;
    }

    /* Nav arrows */
    .carousel-nav {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      z-index: 40;
      width: 52px;
      height: 52px;
      border-radius: 999px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(41, 152, 237, 0.95);
      color: white;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
      font-size: 35px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 160ms ease, background 160ms ease;
    }

    .carousel-nav:hover {
      transform: translateY(-50%) scale(1.06);
    }

    .carousel-nav-left {
      left: -10px;
    }

    .carousel-nav-right {
      right: -10px;
    }

    /* Make the whole slide scrollable while keeping its fixed size */
    .update-item {
      /* keep positioning & transitions as before */
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      padding: 2rem;
      display: flex;
      gap: 2rem;
      align-items: center;
      /* allow vertical scrolling of content */
      justify-content: center;
      background: #ffffff;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(18, 38, 74, 0.06);
      opacity: 0;
      transform: translateX(100%);
      transition: transform 600ms cubic-bezier(.2, .9, .2, 1), opacity 300ms ease;
      z-index: 10;

      /* NEW: make slide itself scrollable (vertical) */
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      /* smooth scrolling on iOS */
      scrollbar-width: thin;
      /* Firefox */
    }

    /* ensure children can shrink inside flex so vertical scroll works properly */
    .update-left,
    .update-right {
      min-width: 0;
      /* important to prevent overflow due to long content */
    }

    /* optional: nicer scrollbar (webkit browsers) */
    .update-item::-webkit-scrollbar {
      width: 10px;
    }

    .update-item::-webkit-scrollbar-thumb {
      background: rgba(30, 58, 138, 0.18);
      border-radius: 999px;
    }

    .update-item::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.03);
    }

    /* Visible slide */
    .update-item.current {
      opacity: 1;
      transform: translateX(0);
      z-index: 20;
    }

    /* Exit left / Enter right classes */
    .update-item.enter-from-right {
      transform: translateX(100%);
    }

    .update-item.enter-from-left {
      transform: translateX(-100%);
    }

    .update-item.enter-to-center {
      transform: translateX(0);
    }

    .update-item.exit-to-left {
      transform: translateX(-100%);
      opacity: 0;
      z-index: 5;
    }

    .update-item.exit-to-right {
      transform: translateX(100%);
      opacity: 0;
      z-index: 5;
    }

    /* slide inner layout: image + text */
    .update-left {
      flex: 1 1 50%;
    }

    .update-right {
      flex: 1 1 50%;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    /* Content parts (hidden initially) */
    .update-title,
    .update-subtitle,
    .update-content,
    .update-image {
      opacity: 0;
      transform: translateY(12px);
    }

    /* fade-in part animation */
    @keyframes fadeInPart {
      from {
        opacity: 0;
        transform: translateY(12px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .fade-in {
      animation: fadeInPart 500ms forwards;
    }

    /* Styling for parts */
    .update-title {
      font-size: 2rem;
      font-weight: 700;
      color: #0f172a;
      margin-bottom: 0.5rem;
    }

    .update-subtitle {
      font-size: 1.15rem;
      color: #374151;
      margin-bottom: 0.75rem;
    }

    .update-content {
      font-size: 1rem;
      color: #4b5563;
      line-height: 1.5;
    }

    .update-image {
      width: 100%;
      height: 360px;
      object-fit: contain;
      /* fits fully in box */
      border-radius: 10px;
      background: #f3f4f6;
    }

    /* Read more button */
    .read-more-btn {
      color: #1e3a8a;
      font-weight: 600;
      cursor: pointer;
      display: inline-block;
      margin-top: 0.5rem;
    }

    .read-more-btn:hover {
      color: #2563eb;
    }

    /* Responsive: stack on small */
    @media (max-width: 768px) {
      .updates-carousel {
        height: 640px;
        padding: 1rem;
      }

      .update-item {
        padding: 1rem;
        flex-direction: column-reverse;
        gap: 1rem;
      }

      .update-left,
      .update-right {
        width: 100%;
        flex-basis: auto;
      }

      .update-image {
        height: 280px;
      }

      .updates-heading h2 {
        font-size: 1.5rem;
      }
    }

    /* ---------- Marquee base styles (single track) ---------- */
    .clients-marquee-section {
      width: 100%;
      background: #ffffff;
      padding: 1rem 0;
      box-sizing: border-box;
    }

    .clients-marquee-wrap {
      --marquee-gap: 1.25rem;
      --logo-height-desktop: 80px;
      --logo-height-mobile: 56px;
      --px-per-second: 120;

      max-width: 1300px;
      margin: 0 auto;
      overflow: hidden;
      position: relative;
      padding: 0 1rem;
    }

    /* SINGLE track that will contain clients + a duplicated set for seamless looping */
    .marquee-track {
      display: inline-flex;
      align-items: center;
      gap: var(--marquee-gap);
      white-space: nowrap;
      will-change: transform;
      animation-name: marquee-scroll;
      animation-timing-function: linear;
      animation-iteration-count: infinite;
      animation-duration: 20s;
      /* fallback; JS will set correct duration */
      animation-play-state: running;
    }

    /* Pause on hover */
    .clients-marquee-wrap:hover .marquee-track {
      animation-play-state: paused;
    }

    /* item */
    .marquee-item {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      flex: 0 0 auto;
      box-sizing: border-box;
    }

    .marquee-item .logo-box {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: var(--logo-height-desktop);
      min-width: calc(var(--logo-height-desktop) * 2);
      padding: 0.3rem 0.75rem;
      box-sizing: border-box;
      border-radius: 6px;
      background: transparent;
    }

    .marquee-item img {
      max-height: 100%;
      max-width: 100%;
      object-fit: contain;
      display: block;
    }

    /* animation: translate left by 50% (we duplicate content inside the same track) */
    @keyframes marquee-scroll {
      from {
        transform: translateX(0);
      }

      to {
        transform: translateX(-50%);
      }
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .clients-marquee-wrap {
        --logo-height-desktop: 64px;
      }

      .marquee-item .logo-box {
        min-width: calc(var(--logo-height-desktop) * 1.8);
      }
    }

    @media (max-width: 640px) {
      .clients-marquee-wrap {
        --logo-height-desktop: var(--logo-height-mobile);
        padding: 0 0.5rem;
      }

      .marquee-item .logo-box {
        min-width: calc(var(--logo-height-mobile) * 1.8);
        padding: 0.2rem 0.5rem;
      }
    }

    /* Slideshow styling */
    .slideshow-container {
      position: absolute;
      inset: 0;
    }

    .slide {
      position: absolute;
      inset: 0;
      background-size: cover;
      background-position: center;
      opacity: 0;
      transition: opacity 1s ease-in-out;
    }

    .slide.active {
      opacity: 1;
    }

    /* Fade animation for service text */
    .service-text {
      opacity: 1;
      transition: opacity 0.8s ease-in-out;
    }

    /* Fade animations for whole text block */
    #slide-container.fade-out {
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }

    #slide-container.fade-in {
      opacity: 1;
      transform: translateY(0);
      transition: opacity 0.8s ease, transform 0.8s ease;
    }
  </style>
</head>

<body>
  <!-- Floating Social Icons with Glassmorphism -->
  <div class="fixed right-4 top-1/2 transform -translate-y-1/2 z-50">
    <ul class="flex flex-col gap-4">
      <!-- Instagram -->
      <li>
        <a href="https://www.instagram.com/psychepanacea" target="_blank" rel="noopener" aria-label="Instagram"
          class="w-14 h-14 flex items-center justify-center rounded-full bg-white/20 shadow-lg border border-white/30 hover:scale-105 transition-transform">
          <!-- Instagram Official Gradient -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24">
            <defs>
              <linearGradient id="instaGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#f58529" />
                <stop offset="30%" stop-color="#dd2a7b" />
                <stop offset="60%" stop-color="#8134af" />
                <stop offset="100%" stop-color="#515bd4" />
              </linearGradient>
            </defs>
            <path fill="url(#instaGradient)"
              d="M12 2.163c3.204 0 3.584.012 4.85.07 1.17.054 1.97.24 2.427.403a4.92 4.92 0 0 1 1.77 1.05 4.92 4.92 0 0 1 1.05 1.77c.163.457.349 1.257.403 2.427.058 1.266.07 1.646.07 4.85s-.012 3.584-.07 4.85c-.054 1.17-.24 1.97-.403 2.427a4.92 4.92 0 0 1-1.05 1.77 4.92 4.92 0 0 1-1.77 1.05c-.457.163-1.257.349-2.427.403-1.266.058-1.646.07-4.85.07s-3.584-.012-4.85-.07c-1.17-.054-1.97-.24-2.427-.403a4.92 4.92 0 0 1-1.77-1.05 4.92 4.92 0 0 1-1.05-1.77c-.163-.457-.349-1.257-.403-2.427C2.175 15.747 2.163 15.367 2.163 12s.012-3.584.07-4.85c.054-1.17.24-1.97.403-2.427a4.92 4.92 0 0 1 1.05-1.77 4.92 4.92 0 0 1 1.77-1.05c.457-.163 1.257-.349 2.427-.403C8.416 2.175 8.796 2.163 12 2.163z" />
            <path fill="white"
              d="M12 5.838a6.162 6.162 0 1 0 0 12.324 6.162 6.162 0 0 0 0-12.324zm0 10.162a3.999 3.999 0 1 1 0-7.998 3.999 3.999 0 0 1 0 7.998z" />
            <circle cx="18.406" cy="5.594" r="1.44" fill="white" />
          </svg>
        </a>
      </li>

      <!-- LinkedIn -->
      <li>
        <a href="https://www.linkedin.com/company/psyche-panacea-consulting" target="_blank" rel="noopener"
          aria-label="LinkedIn"
          class="w-14 h-14 flex items-center justify-center rounded-full bg-white/20 shadow-lg border border-white/30 hover:scale-105 transition-transform">
          <!-- LinkedIn Official Blue -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="#0077B5">
            <path
              d="M22.225 0H1.771C.791 0 0 .771 0 1.723v20.554C0 23.228.791 24 1.771 24h20.451C23.207 24 24 23.228 24 22.277V1.723C24 .771 23.207 0 22.225 0zM7.06 20.452H3.557V9h3.503v11.452zM5.308 7.433a2.029 2.029 0 1 1 0-4.058 2.029 2.029 0 0 1 0 4.058zm15.144 13.019h-3.502v-5.604c0-1.336-.027-3.057-1.862-3.057-1.864 0-2.15 1.456-2.15 2.961v5.7H9.435V9h3.361v1.561h.048c.468-.889 1.613-1.828 3.32-1.828 3.552 0 4.288 2.34 4.288 5.379v6.34z" />
          </svg>
        </a>
      </li>

      <!-- WhatsApp -->
      <li>
        <a href="https://wa.me/919311452925" target="_blank" rel="noopener" aria-label="WhatsApp"
          class="w-14 h-14 flex items-center justify-center rounded-full bg-white/10 shadow-lg border border-white/30 hover:scale-105 transition-transform">
          <!-- WhatsApp Official Green -->
          <svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="#25D366">
            <path
              d="M20.52 3.48A11.86 11.86 0 0 0 12 .05 11.86 11.86 0 0 0 3.48 3.48 11.865 11.865 0 0 0 .05 12c0 2.07.544 4.02 1.58 5.76L0 24l6.48-1.7A11.92 11.92 0 0 0 12 24c6.57 0 11.92-5.35 11.92-11.92 0-3.19-1.24-6.19-3.4-8.6zM12 22.08c-1.92 0-3.79-.52-5.42-1.5l-.39-.23-3.84 1.01 1.02-3.75-.25-.38A9.97 9.97 0 0 1 2 12c0-5.52 4.48-10 10-10s10 4.48 10 10S17.52 22.08 12 22.08z" />
            <path
              d="M17.47 14.38c-.3-.15-1.76-.87-2.03-.97-.27-.1-.47-.15-.67.15-.2.3-.77.96-.94 1.16-.17.2-.35.22-.64.07-.3-.15-1.25-.46-2.39-1.48-.88-.79-1.48-1.76-1.65-2.06-.17-.3-.02-.46.13-.61.13-.13.3-.35.45-.52.15-.17.2-.3.3-.5.1-.2 0-.37-.05-.52-.05-.15-.67-1.61-.92-2.21-.24-.58-.49-.5-.67-.51l-.57-.01c-.2 0-.52.07-.8.37s-1.04 1.02-1.04 2.48 1.07 2.88 1.21 3.07c.15.2 2.1 3.2 5.08 4.49 0 0 .47.2.84.15.38-.05 1.32-.54 1.51-1.06.19-.52.19-.97.13-1.06-.06-.1-.2-.15-.4-.3z" />
          </svg>
        </a>
      </li>
    </ul>
  </div>

  <!-- Header -->
  <header>
    <div class="flex items-center space-x-2">
      <img class="h-16 w-14" src="/images/psypan-logo-transparent.png" alt="Psyche Panacea"
        style="height: 80px; width: 80px;">
      <div class="text-2xl font-bold text-primary" style="font-family: 'Playfair Display', serif; font-size: 2rem;">
        Psyche Panacea</div>
    </div>
    <nav class="hidden md:flex items-center space-x-6">
      <a href="index.html" class="text-primary font-semibold transition-colors px-2 py-1">Home</a>
      <a href="services.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Services</a>
      <a href="flagship-programs.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Flagship
        Programs</a>
      <a href="events.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Events</a>
      <a href="gallery.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Gallery</a>
      <a href="about-us.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">About Us</a>
      <a href="blogs.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Blogs</a>
      <a href="contact.html" class="text-gray-700 hover:text-primary transition-colors px-2 py-1">Contact</a>
    </nav>

    <!-- Mobile Menu Button -->
    <div class="md:hidden flex items-center" style="height: 40px;">
      <button id="mobile-menu-button" class="text-gray-700 hover:text-primary">
        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-8 h-8">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </div>
  </header>

  <!-- Mobile Dropdown Menu -->
  <div id="mobile-menu" class="mt-16 md:hidden bg-white shadow-lg rounded-b-lg hidden">
    <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
      <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-primary bg-blue-50">Home</a>
      <a href="services.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Services</a>
      <a href="flagship-programs.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Flagship
        Programs</a>
      <a href="events.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Events</a>
      <a href="gallery.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Gallery</a>
      <a href="about-us.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">About
        Us</a>
      <a href="blogs.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Blogs</a>
      <a href="contact.html"
        class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-primary hover:bg-blue-50">Contact</a>
    </div>
  </div>

  <!-- Hero Section -->
  <section class="pt-32 relative overflow-hidden" style="height: 700px;">
    <!-- Background slideshow container -->
    <div class="absolute inset-0 z-0">
      <!-- Background overlay -->
      <div class="absolute inset-0 bg-black opacity-50 z-10"></div>

      <!-- Slideshow images -->
      <div class="slideshow-container">
        <div class="slide" style="background-image: url('/images/bd1.png');"></div>
        <div class="slide" style="background-image: url('/images/bd2.jpg');"></div>
        <div class="slide" style="background-image: url('/images/bd3.jpg');"></div>
        <div class="slide" style="background-image: url('/images/bd4.jpg');"></div>
        <div class="slide" style="background-image: url('/images/bd5.jpg');"></div>
      </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24 relative z-10">
      <div class="flex items-center">

        <!-- ← Arrows -->
        <div class="flex flex-col items-center space-y-4 mr-8">
          <button id="arrow-up"
            class="w-12 h-12 bg-white rounded-full shadow flex items-center justify-center transform transition duration-200 hover:scale-110 hover:bg-secondary">
            ▲
          </button>
          <button id="arrow-down"
            class="w-12 h-12 bg-white rounded-full shadow flex items-center justify-center transform transition duration-200 hover:scale-110 hover:bg-secondary">
            ▼
          </button>
        </div>

        <!-- → Text & CTAs -->
        <div class="overflow-hidden">
          <div id="slide-container" class="space-y-12 transform transition-all duration-700 ease-in-out opacity-100">

            <!-- Title + bar -->
            <div class="flex items-center space-x-4">
              <h1 class="text-4xl md:text-5xl font-bold text-white leading-tight" style="font-size: 4rem;">
                Welcome To<br>
                <span class="text-white">Psyche Panacea</span>
              </h1>
            </div>

            <!-- Dynamic service line -->
            <div id="service-label" class="service-text text-xl text-white font-medium"
              style="font-size: 2rem; font-weight: 400;">
              Management Training
            </div>

            <!-- CTAs -->
            <div class="flex flex-wrap gap-4">
              <a href="#contact"
                class="bg-primary hover:bg-secondary text-white px-6 py-3 rounded-lg font-medium transition duration-300">
                Call Us
              </a>
              <a href="#services"
                class="bg-white text-primary border-2 border-primary hover:bg-gray-400 px-6 py-3 rounded-lg font-medium transition duration-300">
                Know More
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="bg-primary py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-2 md:grid-cols-4 gap-8 text-center">
        <div class="animate-on-scroll">
          <div id="clients-stat" class="stats-value">350</div>
          <div class="stats-label">Satisfied Clients</div>
        </div>
        <div class="animate-on-scroll">
          <div id="experience-stat" class="stats-value">24+</div>
          <div class="stats-label">Years of Experience</div>
        </div>
        <div class="animate-on-scroll">
          <div id="retention-stat" class="stats-value">98%</div>
          <div class="stats-label">Training Associates</div>
        </div>
        <div class="animate-on-scroll">
          <div style="font-size: 3rem; font-weight: bold; color: white; margin-bottom: 0.5rem;">375000+</div>
          <div class="stats-label">Participants Trained</div>
        </div>
      </div>
    </div>
  </section>

  <!-- UPDATES SECTION (drop-in) -->
  <section class="updates-section py-12">
    <div class="updates-heading">
      <h2 id="updates-title">Latest Updates</h2>
    </div>

    <div id="updates-carousel" class="updates-carousel" aria-live="polite">
      <!-- arrows -->
      <button id="prevBtn" class="carousel-nav carousel-nav-left" aria-label="Previous update">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="arrow-icon">
          <path d="M15 19l-7-7 7-7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>

      <button id="nextBtn" class="carousel-nav carousel-nav-right" aria-label="Next update">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="arrow-icon">
          <path d="M9 5l7 7-7 7" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>
      <!-- slides will be injected here by JS -->
    </div>
  </section>


  <!-- About Section -->
  <section id="about" class="py-16 bg-light">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl font-bold text-dark mb-4 animate-on-scroll">About Psyche Panacea</h2>
        <div class="w-20 h-1 bg-primary mx-auto mb-6"></div>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto animate-on-scroll">
          Pioneers in Corporate Training Solutions
        </p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        <div class="animate-on-scroll">
          <div class=" w-full h-96"><img class="object-contain w-full h-full" src="/images/psypan-logo-transparent.png"
              alt=""></div>
        </div>
        <div class="animate-on-scroll">
          <p class="text-lg text-gray-700 mb-6">
            Psyche Panacea has been at the forefront of corporate training and HR consulting since 2001. With over 350
            satisfied clients, we bring innovative methodologies and transformative experiences to organizations across
            India.
          </p>
          <p class="text-lg text-gray-700 mb-8">
            Our unique approach combines psychological insights with practical business applications, creating programs
            that deliver measurable ROI and lasting impact.
          </p>
          <ul class="space-y-4 mb-8">
            <li class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
                  <i class="fas fa-check text-white text-xs"></i>
                </div>
              </div>
              <p class="ml-3 text-lg text-gray-700">Proven methodologies with measurable results</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
                  <i class="fas fa-check text-white text-xs"></i>
                </div>
              </div>
              <p class="ml-3 text-lg text-gray-700">Customized solutions for diverse industries</p>
            </li>
            <li class="flex items-start">
              <div class="flex-shrink-0 mt-1">
                <div class="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center">
                  <i class="fas fa-check text-white text-xs"></i>
                </div>
              </div>
              <p class="ml-3 text-lg text-gray-700">Expert trainers with industry experience</p>
            </li>
          </ul>
          <a href="contact.html"
            class="inline-block bg-primary hover:bg-secondary text-white px-6 py-3 rounded-lg font-medium transition duration-300">
            Connect With Us
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Services Section — Flip-on-hover cards (copy-paste) -->
  <section id="services" class="py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl font-bold text-dark mb-4">Our Services</h2>
        <div class="w-20 h-1 bg-primary mx-auto mb-6"></div>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto">
          Innovative training solutions that drive measurable results
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Card 1: Management Trainings -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT: icon + label -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-blue-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-chalkboard-teacher text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Management Trainings</h3>
                  <p class="text-sm text-gray-500 mt-1">Leadership, decision-making & strategy</p>
                </div>
              </div>
            </div>

            <!-- BACK: details -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Management Trainings</h4>
                <p class="text-gray-600">
                  Practical programs for new and seasoned managers that focus on people management, strategic thinking,
                  performance coaching and measurable leadership outcomes to drive business results.
                </p>
                <div class="mt-2">
                  <a href="services.html#management"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Explore
                    program</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 2: Employee Engagements Trainings -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-green-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-users text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Employee Engagements Trainings</h3>
                  <p class="text-sm text-gray-500 mt-1">Boost morale, retention & collaboration</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Employee Engagements Trainings</h4>
                <p class="text-gray-600">
                  Interactive interventions and workshops that strengthen team cohesion, increase engagement scores and
                  build practices that improve employee experience and retention.
                </p>
                <div class="mt-2">
                  <a href="services.html#employee-engagement"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Request
                    a session</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 3: HR Consulting Premium -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-yellow-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-briefcase text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">HR Consulting Premium</h3>
                  <p class="text-sm text-gray-500 mt-1">Policies, org design & strategic HR</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">HR Consulting Premium</h4>
                <p class="text-gray-600">
                  End-to-end HR advisory — from capability frameworks and compensation design to talent strategy and
                  change
                  programs that align HR operations with business goals.
                </p>
                <div class="mt-2">
                  <a href="services.html#hr-premium"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Get
                    consultancy</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 4: Employee Assistance Program -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-indigo-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-hands-helping text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Employee Assistance Program</h3>
                  <p class="text-sm text-gray-500 mt-1">Wellbeing, support & crisis management</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Employee Assistance Program</h4>
                <p class="text-gray-600">
                  Confidential support services, counseling linkages and manager toolkits to help employees through
                  personal
                  or professional challenges while protecting business continuity.
                </p>
                <div class="mt-2">
                  <a href="services.html#assistance"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Contact
                    us</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 5: Outbound Trainings/Offsites -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-purple-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-hiking text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Outbound Trainings/Offsites</h3>
                  <p class="text-sm text-gray-500 mt-1">Experiential learning & team bonding</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Outbound Trainings/Offsites</h4>
                <p class="text-gray-600">
                  Adventure-based and facilitation-led offsites that convert shared experiences into improved
                  collaboration,
                  trust and practical team rituals to carry back to the workplace.
                </p>
                <div class="mt-2">
                  <a href="services.html#outbound"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Request
                    quote</a>
                </div>
              </div>
            </div>
          </div>
        </article>

        <!-- Card 6: Soft Skills -->
        <article class="flip-card bg-white rounded-xl shadow-lg animate-on-scroll" tabindex="0" role="button"
          aria-pressed="false">
          <div class="flip-card-inner">
            <!-- FRONT -->
            <div class="flip-card-front">
              <div class="flex items-center space-x-4">
                <div class="w-16 h-16 bg-pink-100 rounded-lg flex items-center justify-center">
                  <i class="fas fa-comments text-primary text-2xl" aria-hidden="true"></i>
                </div>
                <div>
                  <h3 class="text-xl font-bold text-dark mb-0">Soft Skills</h3>
                  <p class="text-sm text-gray-500 mt-1">Communication, influence & emotional intelligence</p>
                </div>
              </div>
            </div>

            <!-- BACK -->
            <div class="flip-card-back">
              <div class="card-back-inner">
                <h4 class="text-lg font-semibold text-dark">Soft Skills</h4>
                <p class="text-gray-600">
                  Practical modules focusing on communication, presentation, stakeholder management and EI — designed to
                  improve day-to-day effectiveness and leadership presence.
                </p>
                <div class="mt-2">
                  <a href="services.html#soft-skills"
                    class="inline-block px-4 py-2 rounded-md border border-primary text-primary hover:bg-primary hover:text-white transition">Learn
                    more</a>
                </div>
              </div>
            </div>
          </div>
        </article>
      </div>

    </div>
  </section>

  <!-- Testimonials Section -->
  <section id="testimonials" class="py-16 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-dark mb-4 animate-on-scroll">What Our Clients Say</h2>
        <div class="w-20 h-1 bg-primary mx-auto mb-6"></div>
        <p class="text-gray-600 max-w-2xl mx-auto">Real feedback from organisations and participants who attended
          our
          programs.</p>
      </div>

      <!-- Main testimonial display card -->
      <div class="max-w-3xl mx-auto bg-white rounded-2xl p-8 shadow-lg relative">
        <!-- Add Review button -->
        <div class="absolute top-6 right-6">
          <button id="addReviewBtn" class="px-4 py-2 bg-primary text-white rounded-lg shadow hover:opacity-95">
            + Add Review
          </button>
        </div>

        <div class="flex items-center mb-6">
          <img id="testimonial-photo" src="" alt="Client photo"
            class="w-20 h-20 rounded-full object-cover border-2 border-indigo-50 shadow-sm" />
          <div class="ml-4">
            <div id="testimonial-name" class="font-bold text-xl">Name Here</div>
            <div id="testimonial-role" class="text-primary text-sm">Role • Company</div>
          </div>
        </div>

        <p id="testimonial-text" class="text-gray-700 text-lg italic mb-6">
          “Testimonial text goes here.”
        </p>

        <div id="testimonial-stars" class="flex items-center mb-6"></div>

        <div class="flex items-center justify-between">
          <div>
            <button id="prev-btn" class="px-3 py-2 rounded-md border border-gray-200 hover:bg-slate-50 text-sm">
              ← Prev
            </button>
            <button id="next-btn" class="ml-3 px-3 py-2 rounded-md border border-gray-200 hover:bg-slate-50 text-sm">
              Next →
            </button>
          </div>

          <div id="testimonial-counter" class="text-sm text-gray-500">0 of 0</div>
        </div>
      </div>

      <!-- Live grid of recent testimonials -->
      <div class="mt-10 max-w-7xl mx-auto">
        <h3 class="text-lg font-semibold mb-4">Recent Reviews</h3>
        <div id="testimonials-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>
    </div>

    <!-- Add Review Modal -->
    <div id="reviewModal" style="z-index: 1000;"
      class="fixed inset-0 z-50 hidden items-center justify-center bg-black/40 p-4">
      <div class="bg-white rounded-xl w-full max-w-xl p-6 shadow-lg relative">
        <button id="modalClose" class="absolute top-4 right-4 text-gray-500 text-2xl">×</button>
        <h4 class="text-xl font-bold mb-3">Add a Review</h4>

        <form id="reviewForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700">Full name</label>
            <input id="r-name" required class="mt-1 block w-full border border-gray-200 rounded-md p-2"
              placeholder="e.g. Priya Sharma" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700">Role / Company</label>
            <input id="r-role" class="mt-1 block w-full border border-gray-200 rounded-md p-2"
              placeholder="e.g. HR Manager • ACME Corp" />
          </div>



          <!-- NEW: File upload input for Cloudinary -->
          <div>
            <label class="block text-sm font-medium text-gray-700">Upload Your Photo (optional)</label>
            <input id="r-photo-file" type="file" accept="image/*" class="mt-1 block w-full" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700">Rating</label>
            <select id="r-rating" required class="mt-1 block w-36 border border-gray-200 rounded-md p-2">
              <option value="5">5 — Excellent</option>
              <option value="4">4 — Very Good</option>
              <option value="3">3 — Good</option>
              <option value="2">2 — Fair</option>
              <option value="1">1 — Poor</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700">Review</label>
            <textarea id="r-text" rows="4" required class="mt-1 block w-full border border-gray-200 rounded-md p-2"
              placeholder="Write your experience..."></textarea>
          </div>

          <div class="flex justify-end gap-3">
            <button type="button" id="modalCancel" class="px-4 py-2 rounded-md border border-gray-200">Cancel</button>
            <button type="submit" id="modalSubmit" class="px-4 py-2 bg-primary text-white rounded-md">Submit
              Review</button>
          </div>

          <div id="formMsg" class="text-sm text-green-600 mt-2 hidden"></div>
        </form>
      </div>
    </div>
  </section>

  <!-- Cloudinary CDN (declaration) -->
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>

  <!-- CLIENT LOGO MARQUEE (single-row, no double-vertical logos) -->
  <section id="clients-marquee" class="clients-marquee-section" aria-label="Our clients">
    <div class="clients-marquee-wrap">
      <div class="marquee-track" aria-hidden="true"></div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="bg-gray-900 text-white py-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
        <!-- Left half: Map -->
        <div class="w-full map-container rounded-xl overflow-hidden border-2 border-blue-700 shadow-lg">
          <iframe src="https://maps.google.com/maps?q=28.467519771527627,77.03697016794533&z=15&output=embed"
            width="100%" height="100%" frameborder="0" style="border:0;" allowfullscreen loading="lazy"
            class="filter grayscale hover:grayscale-0 transition-all duration-500 pointer-events-auto"
            gestureHandling="greedy">
          </iframe>
        </div>

        <!-- Right half: Content -->
        <div class="grid grid-cols-1 gap-8">
          <!-- Company Info -->
          <div>
            <div class="flex items-center mb-4">
              <div class="bg-gradient-to-r from-blue-600 to-blue-800 p-2 rounded-lg mr-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24"
                  stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                </svg>
              </div>
              <h3 class="text-xl font-bold text-blue-400">Psyche Panacea</h3>
            </div>
            <p class="text-gray-400">
              Pioneers of innovative and breakthrough methodologies in the Indian consultation arena,
              transforming organizations through strategic HR solutions.
            </p>
          </div>

          <!-- Contact Info -->
          <div>
            <h4 class="text-lg font-semibold mb-3 text-blue-400 border-b border-blue-700 pb-1">Contact Us
            </h4>
            <ul class="space-y-4 text-gray-400 text-sm">
              <li class="flex items-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 mt-1 text-blue-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
                <span>308/2, Old Delhi Rd, adjacent Country Inn,<br>Sector 12 A, Anamika
                  Enclave,<br>Gurugram, Haryana 122001 India</span>
              </li>
              <li class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                </svg>
                <button onclick="window.location.href='tel:09810323292'">09810323292</button>
              </li>
              <li class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-blue-500" fill="none"
                  viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                </svg>
                <button onclick="window.location.href='mailto:hr@psypanconsulting.com'">hr@psypanconsulting.com</button>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Footer Bottom -->
      <div class="border-t border-gray-800 mt-12 pt-6 text-center text-gray-500 text-sm">
        <p>© 2025 Psyche Panacea. All rights reserved. Designed by Psyche Panacea Team.</p>
      </div>
    </div>
  </footer>

  <!-- Chatbot -->
  <div class="chatbot fixed bottom-6 right-4 z-50" style="z-index: 1000;">
    <!-- Toggle / Floating Button -->
    <button id="chatbotToggle"
      class="chatbot-toggle w-14 h-14 sm:w-16 sm:h-16 bg-gradient-to-br from-blue-500 to-blue-700 rounded-full flex items-center justify-center cursor-pointer shadow-lg text-white"
      aria-label="Open chat">
      <img src="Chatbot.gif" alt="">
    </button>

    <!-- Chat window -->
    <div id="chatbotWindow"
      class="chatbot-window w-80 sm:w-96 max-h-[540px] absolute bottom-20 sm:bottom-24 right-0 bg-white rounded-xl shadow-2xl hidden border border-blue-100 flex flex-col overflow-hidden">
      <!-- Header -->
      <div
        class="chatbot-header bg-gradient-to-r from-blue-500 to-blue-700 text-white p-3 sm:p-4 rounded-t-xl flex justify-between items-center">
        <div>
          <div class="font-bold text-sm sm:text-base">PsypanChatbot</div>
          <div class="text-xs opacity-90">Your virtual guide</div>
        </div>
        <div class="flex items-center gap-2">
          <button id="chatbotClose" class="chatbot-close text-2xl leading-none">×</button>
        </div>
      </div>

      <!-- Body -->
      <div id="chatbotBody" class="chatbot-body p-3 sm:p-4 overflow-y-auto flex-1 space-y-3 bg-white">
        <!-- Messages will be inserted here by JavaScript -->
      </div>

      <!-- Options Container -->
      <div id="chatOptions" class="p-3 bg-white border-t border-gray-200">
        <!-- Options will be inserted here by JavaScript -->
      </div>

      <!-- Input area -->
      <div class="chatbot-input p-2 sm:p-3 border-t border-gray-200 flex gap-2 items-center">
        <input id="chatbotInput" type="text"
          class="flex-1 p-2 sm:p-3 border border-gray-300 rounded-lg text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-blue-300"
          placeholder="Type your message here...">
        <button id="chatbotSend"
          class="bg-blue-500 text-white px-3 sm:px-4 py-2 sm:py-3 rounded-lg font-semibold text-sm sm:text-base hover:bg-blue-600 transition">Send</button>
      </div>
    </div>
  </div>
  <!-- Put this JS before </body> -->
  <script>
      (function () {
        const btn = document.getElementById('mobile-menu-button');
        const menu = document.getElementById('mobile-menu');

        if (!btn || !menu) return;

        // initialize aria states
        btn.setAttribute('aria-expanded', 'false');
        menu.setAttribute('aria-hidden', 'true');

        // helper to open/close
        function openMenu() {
          menu.classList.remove('hidden');
          menu.classList.add('open');
          btn.setAttribute('aria-expanded', 'true');
          menu.setAttribute('aria-hidden', 'false');
          document.documentElement.classList.add('body-no-scroll');

          // focus first link for keyboard users
          const firstLink = menu.querySelector('a, button');
          if (firstLink) firstLink.focus({ preventScroll: true });
        }

        function closeMenu() {
          menu.classList.remove('open');
          // keep hidden attribute until transition finishes for smoothness
          menu.setAttribute('aria-hidden', 'true');
          btn.setAttribute('aria-expanded', 'false');
          document.documentElement.classList.remove('body-no-scroll');

          // after transition end hide completely to remove pointer-events if .hidden used elsewhere
          const onTransEnd = () => {
            menu.classList.add('hidden');
            menu.removeEventListener('transitionend', onTransEnd);
          };
          // if no transition fire immediately
          const computed = getComputedStyle(menu);
          const dur = parseFloat(computed.transitionDuration) || 0;
          if (dur > 0) {
            menu.addEventListener('transitionend', onTransEnd);
          } else {
            onTransEnd();
          }

          // return focus to button
          btn.focus({ preventScroll: true });
        }

        // toggle handler
        btn.addEventListener('click', (e) => {
          const isOpen = menu.classList.contains('open');
          if (isOpen) closeMenu();
          else openMenu();
        });

        // close when a menu link is clicked
        menu.addEventListener('click', (e) => {
          const target = e.target.closest('a, button');
          if (!target) return;
          // small delay so native navigation begins without abrupt UI change
          setTimeout(closeMenu, 60);
        });

        // close on Escape
        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape' && menu.classList.contains('open')) {
            closeMenu();
          }
        });

        // close on outside click (outside menu and outside button)
        document.addEventListener('click', (e) => {
          if (!menu.classList.contains('open')) return;
          const isInsideMenu = !!e.target.closest('#mobile-menu');
          const isOnButton = !!e.target.closest('#mobile-menu-button');
          if (!isInsideMenu && !isOnButton) closeMenu();
        });

        // ensure correct initial state if menu had no "hidden" class in markup
        if (!menu.classList.contains('hidden') && !menu.classList.contains('open')) {
          menu.classList.add('hidden');
          menu.setAttribute('aria-hidden', 'true');
        }
      })();
  </script>

  <script>
    (function () {
      const chatBody = document.getElementById('chatbotBody');
      if (!chatBody) return;

      // typing speed in ms per character (tweak if you want faster/slower)
      const TYPE_SPEED = 18;

      // Remove any existing typing-indicator nodes (class 'typing-animation') helper
      function clearTypingIndicators() {
        const ind = chatBody.querySelectorAll('.typing-animation');
        ind.forEach(node => node.remove());
      }

      // Smooth scroll helper
      function scrollToBottom() {
        chatBody.scrollTop = chatBody.scrollHeight;
      }

      // Type text into target span element char-by-char
      function typeText(span, fullText, onDone) {
        let i = 0;
        function step() {
          if (i <= fullText.length) {
            // keep caret visible as we type
            span.textContent = fullText.slice(0, i);
            i++;
            scrollToBottom();
            timer = setTimeout(step, TYPE_SPEED);
          } else {
            if (typeof onDone === 'function') onDone();
          }
        }
        let timer = setTimeout(step, TYPE_SPEED);
        return () => clearTimeout(timer);
      }

      // Observe added bot messages
      const observer = new MutationObserver((mutations) => {
        for (const mut of mutations) {
          for (const node of mut.addedNodes) {
            if (!(node instanceof HTMLElement)) continue;

            // ignore typing-indicator nodes
            if (node.classList.contains('typing-animation')) continue;

            // only act on bot messages (class includes 'bot')
            if (node.classList.contains('bot') && !node.dataset.typed) {
              // mark to avoid double-processing
              node.dataset.typed = 'processing';

              // capture original HTML and plain text
              const originalHTML = node.innerHTML || '';
              const plainText = node.textContent ? node.textContent.trim() : '';

              // Clear possible typing indicator(s) so we show our typed text cleanly
              // (we don't remove them earlier to avoid interfering with original flow)
              clearTypingIndicators();

              // Prepare typed container
              node.innerHTML = ''; // remove content
              node.classList.add('bot-typing');

              // create a span to receive typed characters
              const span = document.createElement('span');
              span.className = 'bot-typing-text';
              node.appendChild(span);
              scrollToBottom();

              // If the original content contains HTML tags, we will type its plain-text first,
              // then replace with originalHTML at the end (so lists and markup render properly).
              // If original was plain text, we type it fully and leave as-is.
              const textToType = plainText.length ? plainText : originalHTML.replace(/<[^>]*>/g, '');

              typeText(span, textToType, () => {
                // done typing: if originalHTML had markup, set it now (so lists render)
                if (/<[a-z][\s\S]*>/i.test(originalHTML)) {
                  node.innerHTML = originalHTML;
                } else {
                  // ensure final text exactly matches original (in case of trimming)
                  span.textContent = plainText || originalHTML;
                }
                node.classList.remove('bot-typing');
                node.dataset.typed = 'true';
                scrollToBottom();
              });
            }
          }
        }
      });

      observer.observe(chatBody, { childList: true, subtree: false });

      // Also make existing bot messages (already present on load) appear typed
      // by triggering a small re-process for any untyped bot nodes
      window.addEventListener('load', () => {
        const existing = Array.from(chatBody.querySelectorAll('.bot')).filter(n => !n.dataset.typed);
        existing.forEach(n => {
          // trigger MutationObserver by re-appending node (no visual move)
          // create a shallow clone then replace to fire the observer logic
          const clone = n.cloneNode(true);
          n.replaceWith(clone);
        });
      });

      // tidy: expose a function to force-enable or disable this enhancer if needed
      window.__psypanBotTypingEnhancer = {
        disconnect: () => observer.disconnect(),
        reconnect: () => observer.observe(chatBody, { childList: true, subtree: false })
      };
    })();





    document.addEventListener("DOMContentLoaded", function () {
      const chatbotWindow = document.getElementById("chatbotWindow");
      const chatbotToggle = document.getElementById("chatbotToggle");
      const chatbotClose = document.getElementById("chatbotClose");

      // Open chatbot automatically when page loads
      chatbotWindow.classList.remove("hidden");

      // Toggle chatbot when floating button is clicked
      chatbotToggle.addEventListener("click", () => {
        chatbotWindow.classList.toggle("hidden");
      });

      // Close chatbot when "×" is clicked
      chatbotClose.addEventListener("click", () => {
        chatbotWindow.classList.add("hidden");
      });
    });


    const slides = document.querySelectorAll(".slide");
    const slideContainer = document.getElementById("slide-container");
    const serviceLabel = document.getElementById("service-label");

    // Services linked with slides
    const services = [
      "Management Training",
      "Employee Engagement Programs",
      "HR Consulting",
      "Employee Assistance Programs",
      "Outbound Trainings/Offsite",
      "Soft Skills Training"
    ];

    let currentIndex = 0;
    let slideInterval;

    function updateContent(index) {
      // Fade out the entire block
      slideContainer.classList.add("fade-out");

      setTimeout(() => {
        // Update service text
        serviceLabel.textContent = services[index];

        // Fade in the entire block
        slideContainer.classList.remove("fade-out");
        slideContainer.classList.add("fade-in");

        setTimeout(() => {
          slideContainer.classList.remove("fade-in"); // cleanup
        }, 800);
      }, 800); // wait for fade-out
    }

    function showSlide(index) {
      slides.forEach((slide, i) => {
        slide.classList.toggle("active", i === index);
      });
      updateContent(index);
    }

    function nextSlide() {
      currentIndex = (currentIndex + 1) % slides.length;
      showSlide(currentIndex);
    }

    function prevSlide() {
      currentIndex = (currentIndex - 1 + slides.length) % slides.length;
      showSlide(currentIndex);
    }

    function startSlideshow() {
      slideInterval = setInterval(nextSlide, 3000);
    }

    function stopSlideshow() {
      clearInterval(slideInterval);
    }

    // Arrow navigation
    document.getElementById("arrow-up").addEventListener("click", () => {
      stopSlideshow();
      prevSlide();
      startSlideshow();
    });

    document.getElementById("arrow-down").addEventListener("click", () => {
      stopSlideshow();
      nextSlide();
      startSlideshow();
    });

    // Init
    showSlide(currentIndex);
    startSlideshow();

    /* Use your clients array exactly as provided */
    const clients = [
      // Automotive
      { name: "Honda", image: "honda.png", category: "automotive", tagline: "The Power of Dreams" },
      { name: "Maruti Suzuki", image: "maruti.png", category: "automotive", tagline: "Way of Life" },
      { name: "Hero", image: "hero.png", category: "automotive", tagline: "Desh Ki Dhadkan" },
      { name: "JCB", image: "jcb.png", category: "automotive", tagline: "Powering Progress" },
      { name: "Yamaha", image: "BirlaYamaha.png", category: "automotive", tagline: "Revs Your Heart" },
      { name: "Suzuki Motorcycles", image: "Suzuki-Motorcycles.png", category: "automotive" },
      { name: "JK Tyres", image: "jktyre.png", category: "automotive" },
      { name: "Escort", image: "Escort.png", category: "automotive" },
      { name: "Sona Koyo", image: "Sona-Koyo.jpg", category: "automotive" },
      { name: "Minda", image: "minda.png", category: "automotive" },
      { name: "JBM Group", image: "jbm.png", category: "automotive" },

      // Manufacturing
      { name: "ACC", image: "acc.png", category: "manufacturing", tagline: "The Professional's Choice" },
      { name: "Amtek", image: "Amtek.jpg", category: "manufacturing" },
      { name: "Anchor", image: "Anchor.jpg", category: "manufacturing" },
      { name: "Asahi Glass", image: "Asahi-Glass.png", category: "manufacturing" },
      { name: "ATO", image: "ato.png", category: "manufacturing" },
      { name: "BIRLA POWER", image: "birla-power.png", category: "manufacturing", tagline: "POWER... the ability to change" },
      { name: "Bria", image: "Birla.jpg", category: "manufacturing" },
      { name: "Chemsys", image: "Chemsys.png", category: "manufacturing" },
      { name: "Colgate and Palmolive", image: "ColgateandPalmolive.png", category: "manufacturing" },
      { name: "Daikin", image: "Daikin.png", category: "manufacturing" },
      { name: "Dabur", image: "dabur.png", category: "manufacturing" },
      { name: "Ester Industries", image: "Ester-Industries.png", category: "manufacturing" },
      { name: "Grasim", image: "Grasim.jpg", category: "manufacturing" },
      { name: "Hindustan Zinc", image: "Hindustan-Zinc.png", category: "manufacturing" },
      { name: "Indian Oil", image: "indian-oil.png", category: "manufacturing" },
      { name: "NTPC", image: "ntpc.png", category: "manufacturing" },
      { name: "Shree Cements", image: "Shree-Cements.jpg", category: "manufacturing" },
      { name: "SRF", image: "SRF.png", category: "manufacturing" },

      // Technology
      { name: "Bharti", image: "Bharti.png", category: "technology" },
      { name: "HCL", image: "hcl.png", category: "technology" },
      { name: "Hughes Software", image: "Hughes-Software.png", category: "technology" },
      { name: "ICICI Bank", image: "icici-bank.png", category: "technology" },
      { name: "Mizuho Bank", image: "Mizuho-Bank.png", category: "technology" },
      { name: "RMSI", image: "RMSI.png", category: "technology" },
      { name: "Safran", image: "Safran.png", category: "technology" },
      { name: "SPIL", image: "SPIL.png", category: "technology" },
      { name: "Tech Mahindra", image: "tech-mahindra.png", category: "technology" },
      { name: "TMTL", image: "TMTL.png", category: "technology" },
      { name: "Wabag", image: "Wabag.png", category: "technology" },
      { name: "OMAX Technology", image: "LOGO_OMAX-technology.png", category: "technology" },
      { name: "Nex-Gen", image: "Nex-Gen.png", category: "technology" },
      { name: "Biotech", image: "Biotech.webp", category: "technology" },

      // FMCG
      { name: "Pepsi", image: "pepsi.png", category: "fmg" },
      { name: "Parle-G", image: "Parle-G.jpg", category: "fmg" },
      { name: "Dabur", image: "DABUR (1).png", category: "fmg" },
      { name: "Colgate and Palmolive", image: "Colgate-and-Palmoliv.png", category: "fmg" },
      { name: "Whirlpool", image: "whirl-pool.png", category: "fmg" },
      { name: "Spencer's", image: "spencers.png", category: "fmg" },
      { name: "Van Melle", image: "Van-Melle.png", category: "fmg" },
      { name: "Mother Dairy", image: "Mother-Dairy.jpg", category: "fmg" },
      { name: "BSES", image: "bses.png", category: "fmg" },
      { name: "Antheme", image: "Antheme.png", category: "fmg" },
      { name: "BPT", image: "BPT.png", category: "fmg" },
      { name: "EIL", image: "eil.png", category: "fmg" },
      { name: "LBL", image: "lbl.png", category: "fmg" },
      { name: "UD-Trucks", image: "UD-trucks-logo-637x426.jpg", category: "fmg" },
      { name: "UNO MINDA", image: "UNO MINDA.png", category: "fmg" },
      { name: "Vecv", image: "Vecv.png", category: "fmg" },
    ];

    const COMMON_PATH = 'images/clients/'; // common path requested
    const DEFAULT_PLACEHOLDER = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw=='; // tiny transparent pixel

    function createItemNode(client) {
      const item = document.createElement('div');
      item.className = 'marquee-item';
      const box = document.createElement('div');
      box.className = 'logo-box';

      const img = document.createElement('img');
      img.alt = client.name || '';
      img.src = COMMON_PATH + client.image;
      img.onerror = function () {
        this.onerror = null;
        // try a safe placeholder in images/clients/ first (if you have it), else use transparent pixel
        this.src = COMMON_PATH + 'placeholder.png';
        // if placeholder.png doesn't exist on server, the browser will try that and hit onerror again
        // but we already removed onerror to avoid infinite loop; in that case you will see broken image or provide placeholder.png
      };

      box.appendChild(img);
      item.appendChild(box);
      return item;
    }

    function populateSingleTrack() {
      const track = document.querySelector('.marquee-track');
      if (!track) return;
      track.innerHTML = '';

      // create fragment of original items
      const frag = document.createDocumentFragment();
      clients.forEach(c => frag.appendChild(createItemNode(c)));

      // append original items
      track.appendChild(frag);

      // append a clone of the same items to the same track (seamless loop)
      // we clone nodes to avoid reusing the exact same elements (keeps DOM stable)
      const nodesToClone = Array.from(track.children).slice(0, clients.length);
      nodesToClone.forEach(n => track.appendChild(n.cloneNode(true)));
    }

    function adjustDurationSingleTrack() {
      const wrap = document.querySelector('.clients-marquee-wrap');
      const track = document.querySelector('.marquee-track');
      if (!wrap || !track) return;

      // One set width is half the scrollWidth because we duplicated content inside same track
      const total = track.scrollWidth;
      const oneSetWidth = total / 2 || track.getBoundingClientRect().width / 2;

      const style = getComputedStyle(wrap);
      const pxPerSecond = Math.max(40, parseFloat(style.getPropertyValue('--px-per-second')) || 120);

      // duration so that oneSetWidth travels at pxPerSecond speed (seconds)
      const duration = Math.max(6, (oneSetWidth / pxPerSecond));
      track.style.animationDuration = duration + 's';
    }

    // init
    function initSingleMarquee() {
      populateSingleTrack();

      // wait a bit for images to load and layout to settle before measuring
      setTimeout(() => {
        adjustDurationSingleTrack();
      }, 80);

      // recalc on resize (debounced)
      let t;
      window.addEventListener('resize', () => {
        clearTimeout(t);
        t = setTimeout(adjustDurationSingleTrack, 150);
      });
    }

    document.addEventListener('DOMContentLoaded', initSingleMarquee);

    (function () {
      // --- configuration / content (edit as needed) ---
      const contactInfo = {
        address: '08/2, Old Delhi Rd, adjacent Country In, Sector 12 A, Anamika Enclave,Sector 14, Gurugram, Haryana 122001',
        phones: ['+91 9810319292', '+91 9810323292'],
        email: 'hr@psypanconsulting.com',
      };

      // PAGE URL map
      const pageUrlMap = {
        'Services': 'services.html',
        'Contact': 'contact.html',
        'Gallery': 'gallery.html',
        'Global Programs': 'https://psychepan-mba.netlify.app'
      };

      // Main menu options
      const mainOptions = [
        { id: 1, label: 'Services Offered', icon: '🌐' },
        { id: 2, label: 'Management Trainings', icon: '📊' },
        { id: 3, label: 'Global Executive Devp Programs', icon: '🌍' },
        { id: 4, label: 'Emp Engagement', icon: '👥' },
        { id: 5, label: 'Emp Assistance', icon: '🤝' },
        { id: 6, label: 'OBT Training', icon: '🏕️' },
        { id: 7, label: 'Offsites', icon: '🏞️' },
        { id: 8, label: 'Contact Us', icon: '📞' }
      ];

      // Sub-options for each main option
      const subOptions = {
        1: [
          { label: 'Management Trainings', action: 'redirect', target: 'Services' },
          { label: 'Employee Engagement', action: 'redirect', target: 'Services' },
          { label: 'Global Executive Development', action: 'menu', target: 3 },
          { label: 'Outbound Training', action: 'redirect', target: 'Services' },
          { label: 'Offsites', action: 'redirect', target: 'Services' },
          { label: 'Employee Assistance', action: 'redirect', target: 'Services' }
        ],
        2: [
          { label: '📘 Featured Trainings', action: 'Trainings' },
          { label: '📩 Contact Our Team', action: 'redirect', target: 'Contact' }
        ],
        3: [
          { label: '🌍 Global MBA', action: 'redirect', target: 'Global Programs' },
          { label: '✅ Eligibility', action: 'redirect', target: 'Global Programs' }
        ],
        4: [
          { label: '🎯 EEP Services', action: 'EEPServices' },
          { label: '📩 Contact Our Team', action: 'redirect', target: 'Contact' }
        ],
        5: [
          { label: '🧩 EAP Details', action: 'EAPDetails' },
          { label: '📞 Request Call Back', action: 'Phone' }
        ],
        6: [
          { label: '🏖 Venue Options', action: 'Venues' },
          { label: '🎯 Format Details', action: 'FormatDetails' }
        ],
        7: [
          { label: '🏞 Sample Activities', action: 'SampleActivities' },
          { label: '📸 Go to Gallery', action: 'redirect', target: 'Gallery' }
        ],
        8: [
          { label: '📩 Talk to a Human', action: 'redirect', target: 'Contact' },
          { label: '📅 Book a Consultation', action: 'Email' },
          { label: '📞 Request a Call Back', action: 'Phone' }
        ]
      };

      // Content for various options
      const content = {
        trainings: [
          'Result Oriented Trainings',
          'Impact Assessment Program',
          'Tailormade Program',
          'Employee Feedback Analysis',
          'People & Team Leadership',
          'Strategy & Operational Excellence'
        ],
        eepServices: [
          'Employee Wellness Programme',
          'Employee Development',
          'Employee Konnect',
          'Employee Offsite Program'
        ],
        eapDetails: [
          'Workplace / Mental Health Counselling',
          'Wellness Assessment',
          'Wellness Survey',
          'Wellness Report'
        ],
        venues: [
          'Panchgani', 'Chandipur', 'Bubhneshwar', 'Lonavala', 'Khandala',
          'Jim Corbett', 'Nanital', 'Ranikhet', 'Kausani', 'Kausali',
          'Chail', 'Dhanulti', 'Mussorie', 'Solan', 'Shoghi',
          'Nalagarh', 'Garh Mukteshwar'
        ],
        formatDetails: [
          'Result Oriented OBTs',
          'Strategic OBTs',
          'Immersive Experience',
          'Experiential Strategic & Challenging Group activities'
        ],
        sampleActivities: [
          'Big Picture',
          'Street Jam',
          'Pixel Challenge',
          'Drone Making',
          'Olympic Challenge',
          'Treasure Hunt',
          'Pyramid Challenge',
          'Drop the ball',
          'Ripple Effect',
          'Gladiator'
        ]
      };


      // Bot responses for main options
      const botResponses = {
        1: "We offer a portfolio of services to support organizations and individuals with growth, learning, and transformation. Would you like to explore specific services such as Management Trainings, Employee Engagement, or Outbound Programs?",
        2: "Our management training programs are designed to build leadership skills, strategic thinking, and team effectiveness. They can be customized for different levels of management. Would you like to see available training modules or connect with our team for details?",
        3: "We bring world-class executive development programs through our global collaborations with leading universities and experts. These programs focus on leadership, innovation, and future-ready skills. Would you like an overview or check eligibility to join?",
        4: "We design employee engagement initiatives to boost motivation, collaboration, and workplace satisfaction. Programs include workshops, cultural initiatives, and interactive experiences. Would you like examples of engagement activities?",
        5: "Our Employee Assistance Programs (EAPs) provide confidential support to employees for work-life balance, stress management, and well-being. Would you like to know more about our EAP offerings?",
        6: "Our outbound training programs combine learning with adventure, designed to build teamwork, leadership, and resilience. Would you like to see sample activities or discuss a custom OBT for your team?",
        7: "We organize corporate offsites to strengthen bonding, align strategy, and recharge teams in engaging environments. Would you like options for venues and formats?",
        8: "Would you like to connect with our team directly?"
      };

      // Fallback response
      const fallbackResponse = "❓ I may not know that yet…➡️ Explore services👨‍💼 Talk to a consultant";

      // Track the last question asked by the bot
      let lastQuestionContext = null;

      // Keyword responses (typed input fallback)
      function getBotResponse(message) {
        const lower = message.toLowerCase();

        // Handle yes/no responses to bot questions
        if (lastQuestionContext) {
          if (lower === 'yes' || lower === 'y' || lower === 'yeah' || lower === 'yep') {
            // Handle the "yes" response based on the last question context
            handleActionSelect(lastQuestionContext.action, lastQuestionContext.target);
            lastQuestionContext = null;
            return "";
          } else if (lower === 'no' || lower === 'n' || lower === 'nope') {
            // Clear chat and show main options for "no" response
            bodyEl.innerHTML = '';
            initChatbot();
            lastQuestionContext = null;
            return "";
          }
        }

        // Common words mapping
        if (lower.includes('hello') || lower.includes('hi') || lower.includes('hey')) {
          return "Hello! How can I help you today?";
        }
        if (lower.includes('thank')) {
          return "You're welcome! Is there anything else I can help you with?";
        }
        if (lower.includes('bye') || lower.includes('goodbye')) {
          return "Thank you for chatting with me. Have a great day!";
        }
        if (lower.includes('contact') || lower.includes('address')) {
          return `Our office is located at ${contactInfo.address}`;
        }
        if (lower.includes('phone') || lower.includes('call') || lower.includes('contact number') || lower.includes('number')) {
          return `You can reach us at ${contactInfo.phones.join(' or ')}.`;
        }
        if (lower.includes('email') || lower.includes('mail')) {
          return `For inquiries, please email us at ${contactInfo.email}`;
        }
        if (lower.includes('training') || lower.includes('program') || lower.includes('course')) {
          return 'We offer various training programs including Management Training, Employee Engagement, and Outbound Training.';
        }
        if (lower.includes('service') || lower.includes('offer') || lower.includes('provide')) {
          return 'We provide corporate training solutions in leadership development, team building, and mental wellness programs.';
        }
        if (lower.includes('management') || lower.includes('leadership')) {
          return 'Our management training programs are designed to build leadership skills, strategic thinking, and team effectiveness.';
        }
        if (lower.includes('employee') || lower.includes('staff')) {
          return 'We offer Employee Engagement and Employee Assistance programs to support your workforce.';
        }
        if (lower.includes('global') || lower.includes('executive') || lower.includes('mba')) {
          return 'We bring world-class executive development programs through our global collaborations with leading universities.';
        }
        if (lower.includes('outbound') || lower.includes('obt') || lower.includes('team building')) {
          return 'Our outbound training programs combine learning with adventure, designed to build teamwork and leadership.';
        }
        if (lower.includes('offsites') || lower.includes('offsite')) {
          return 'We organize corporate offsites to strengthen bonding and align strategy in engaging environments.';
        }
        if (lower.includes('help') || lower.includes('support')) {
          return "I'm here to help! You can ask me about our services, training programs, or how to contact us.";
        }

        // fallback
        return fallbackResponse;
      }

      // --- DOM references ---
      const sendBtn = document.getElementById('chatbotSend');
      const inputEl = document.getElementById('chatbotInput');
      const bodyEl = document.getElementById('chatbotBody');
      const optionsContainer = document.getElementById('chatOptions');

      // Track current menu state
      let currentMenu = null;

      // --- helpers ---
      function scrollChatToBottom() {
        bodyEl.scrollTop = bodyEl.scrollHeight;
      }

      function createMessage({ text, who = 'bot', html = false, typing = false }) {
        const wrapper = document.createElement('div');
        wrapper.className =
          'chatbot-message ' +
          (who === 'user'
            ? 'user bg-blue-500 text-white rounded-lg p-3 mb-3 max-w-[80%] ml-auto clear-both text-sm'
            : 'bot bg-blue-50 text-gray-800 rounded-lg p-3 mb-3 max-w-[80%] clear-both text-sm');

        if (typing) {
          wrapper.classList.add('typing-animation');
          wrapper.style.width = 'fit-content';
        }

        if (html) wrapper.innerHTML = text;
        else wrapper.textContent = text;

        bodyEl.appendChild(wrapper);
        scrollChatToBottom();
        return wrapper;
      }

      function createTypingIndicator() {
        return createMessage({ text: 'PsypanChatbot is typing...', who: 'bot', typing: true });
      }

      function removeTypingIndicator(indicator) {
        if (indicator && indicator.parentNode) {
          indicator.classList.remove('typing-animation');
          indicator.style.borderRight = 'none';
        }
      }

      // Show main options
      function showMainOptions() {
        optionsContainer.innerHTML = '';

        mainOptions.forEach(opt => {
          const btn = document.createElement('button');
          btn.className = 'option-btn px-3 py-2 mb-2 text-sm rounded-full bg-blue-100 text-blue-700 hover:bg-blue-200 transition';
          btn.innerHTML = `${opt.icon} ${opt.label}`;
          btn.dataset.option = opt.id;
          optionsContainer.appendChild(btn);
        });

        currentMenu = null;
        scrollChatToBottom();
      }

      // Show sub options
      function showSubOptions(optionId) {
        optionsContainer.innerHTML = '';

        if (subOptions[optionId]) {
          subOptions[optionId].forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn px-3 py-2 mb-2 mr-2 text-sm rounded-full bg-blue-100 text-blue-700 hover:bg-blue-200 transition';
            btn.textContent = opt.label;
            btn.dataset.action = opt.action;
            if (opt.target) btn.dataset.target = opt.target;
            optionsContainer.appendChild(btn);
          });
        }

        // Add back button
        const backBtn = document.createElement('button');
        backBtn.className = 'option-btn px-3 py-2 mb-2 text-sm rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 transition';
        backBtn.textContent = '⬅ Back to Main Menu';
        backBtn.addEventListener('click', () => {
          createMessage({ text: 'What would you like to know about?', who: 'bot' });
          showMainOptions();
        });
        optionsContainer.appendChild(backBtn);

        currentMenu = optionId;
        scrollChatToBottom();
      }

      // Show list of items
      function showList(items, redirectUrl = null) {
        let listHtml = '';
        if (redirectUrl) {
          listHtml = `<div class="bg-white p-3 rounded-lg border border-blue-100">
                        <ul class="list-disc list-inside text-sm">${items.map(item => `<li class="cursor-pointer hover:underline" onclick="window.location.href='${redirectUrl}'">${item}</li>`).join('')}</ul>
                    </div>`;
        } else {
          listHtml = `<div class="bg-white p-3 rounded-lg border border-blue-100">
                        <ul class="list-disc list-inside text-sm">${items.map(item => `<li>${item}</li>`).join('')}</ul>
                    </div>`;
        }
        createMessage({ text: listHtml, who: 'bot', html: true });
      }

      // Redirect to page
      function redirectToPage(page) {
        if (pageUrlMap[page]) {
          createMessage({ text: `Redirecting you to ${page}...`, who: 'bot' });
          setTimeout(() => {
            if (pageUrlMap[page].startsWith('http')) {
              window.open(pageUrlMap[page], '_blank');
            } else {
              window.location.href = pageUrlMap[page];
            }
          }, 1000);
        } else {
          createMessage({ text: `The ${page} page is not available at the moment.`, who: 'bot' });
        }
      }

      // Show phone number
      function showPhone() {
        createMessage({ text: `You can call us at: ${contactInfo.phones[1]}`, who: 'bot' });
      }

      // Show email
      function showEmail() {
        createMessage({ text: `Please email us at: ${contactInfo.email}`, who: 'bot' });
      }

      // Handle option selection
      function handleOptionSelect(optionId) {
        // Create user message
        const optionText = mainOptions.find(opt => opt.id == optionId).label;
        createMessage({ text: optionText, who: 'user' });

        // Show typing indicator
        const typingIndicator = createTypingIndicator();

        // After delay, show bot response and options
        setTimeout(() => {
          removeTypingIndicator(typingIndicator);
          createMessage({ text: botResponses[optionId], who: 'bot' });

          // Set last question context if the response ends with a question mark
          if (botResponses[optionId].endsWith('?')) {
            const firstSubOption = subOptions[optionId] && subOptions[optionId][0];
            if (firstSubOption) {
              lastQuestionContext = {
                action: firstSubOption.action,
                target: firstSubOption.target
              };
            }
          }

          showSubOptions(optionId);
        }, 1500);
      }

      // Handle action selection
      function handleActionSelect(action, target) {
        // Create user message
        const actionText = event ? event.target.textContent : "Yes";
        createMessage({ text: actionText, who: 'user' });

        // Show typing indicator
        const typingIndicator = createTypingIndicator();

        // After delay, handle the action
        setTimeout(() => {
          removeTypingIndicator(typingIndicator);

          switch (action) {
            case 'menu':
              handleOptionSelect(target);
              break;
            case 'Trainings':
              showList(content.trainings, pageUrlMap['Services']);
              showSubOptions(currentMenu);
              break;
            case 'EEPServices':
              showList(content.eepServices, pageUrlMap['Services']);
              showSubOptions(currentMenu);
              break;
            case 'EAPDetails':
              showList(content.eapDetails, pageUrlMap['Services']);
              showSubOptions(currentMenu);
              break;
            case 'Venues':
              showList(content.venues, pageUrlMap['Services']);
              showSubOptions(currentMenu);
              break;
            case 'FormatDetails':
              showList(content.formatDetails, pageUrlMap['Services']);
              showSubOptions(currentMenu);
              break;
            case 'SampleActivities':
              showList(content.sampleActivities);
              showSubOptions(currentMenu);
              break;
            case 'Phone':
              showPhone();
              showSubOptions(currentMenu);
              break;
            case 'Email':
              showEmail();
              showSubOptions(currentMenu);
              break;
            case 'redirect':
              redirectToPage(target);
              break;
            default:
              createMessage({ text: "I'm not sure how to help with that.", who: 'bot' });
              showMainOptions();
          }

          // Clear the last question context after handling the action
          lastQuestionContext = null;
        }, 1500);
      }

      // Initialize chatbot
      function initChatbot() {
        createMessage({ text: "Hello! PsypanChatbot here 👋 Ready to explore our Website?", who: 'bot' });
        showMainOptions();
      }

      // --- event handlers ---
      sendBtn.addEventListener('click', () => {
        const message = inputEl.value.trim();
        if (message) {
          createMessage({ text: message, who: 'user' });
          inputEl.value = '';

          const typingIndicator = createTypingIndicator();

          setTimeout(() => {
            removeTypingIndicator(typingIndicator);
            const response = getBotResponse(message);

            if (response) {
              createMessage({ text: response, who: 'bot' });

              if (response === fallbackResponse) {
                const html = `<div class="flex gap-2 mt-2">
                                    <button data-action="redirect" data-target="Services" class="px-3 py-1 rounded-md bg-blue-500 text-white text-xs">🌐 Explore Services</button>
                                    <button data-action="redirect" data-target="Contact" class="px-3 py-1 rounded-md bg-blue-500 text-white text-xs">🤝 Talk to Consultant</button>
                                </div>`;
                createMessage({ text: html, who: 'bot', html: true });
              } else {
                showMainOptions();
              }
            }
          }, 1000);
        }
      });

      inputEl.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          sendBtn.click();
        }
      });

      // Delegate option clicks
      optionsContainer.addEventListener('click', (e) => {
        if (e.target.dataset.option) {
          handleOptionSelect(e.target.dataset.option);
        } else if (e.target.dataset.action) {
          handleActionSelect(e.target.dataset.action, e.target.dataset.target);
        }
      });

      // Initialize the chatbot when the page loads
      document.addEventListener('DOMContentLoaded', function () {
        initChatbot();
      });
    })();


    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyA8t0YBEkZ-hDHmw7u8aud-jwNybYEKnbU",
      authDomain: "psypanweb-7747a.firebaseapp.com",
      projectId: "psypanweb-7747a",
      storageBucket: "psypanweb-7747a.appspot.com",
      messagingSenderId: "441049264188",
      appId: "1:441049264188:web:4dab8de0554b2c7c741339",
      measurementId: "G-C1CTMX729Z"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    (function () {
      const container = document.getElementById('updates-carousel');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const AUTO_INTERVAL = 3000; // 3 seconds
      let updates = [];
      let idx = 0;
      let autoTimer = null;
      let isPaused = false;
      let currentSlideEl = null;
      let animating = false;

      // Simple truncate helper for Read More (30 words)
      function truncateContent(content, limit = 30) {
        if (!content) return { text: '', isTruncated: false, fullText: '' };
        const words = content.trim().split(/\s+/);
        if (words.length <= limit) return { text: content, isTruncated: false, fullText: content };
        return { text: words.slice(0, limit).join(' ') + '...', isTruncated: true, fullText: content };
      }

      // Build slide DOM for a given data object
      function buildSlide(data) {
        const slide = document.createElement('div');
        slide.className = 'update-item enter-from-right';

        // Left: image, Right: text
        const left = document.createElement('div');
        left.className = 'update-left';
        const img = document.createElement('img');
        img.className = 'update-image';
        img.alt = data.title || 'update image';
        img.src = data.image || '';

        left.appendChild(img);

        const right = document.createElement('div');
        right.className = 'update-right';

        const titleEl = document.createElement('div');
        titleEl.className = 'update-title';
        titleEl.textContent = data.title || '';

        const subtitleEl = document.createElement('div');
        subtitleEl.className = 'update-subtitle';
        subtitleEl.textContent = data.subtitle || '';

        const contentEl = document.createElement('div');
        contentEl.className = 'update-content';

        const truncated = truncateContent(data.content || '', 20);
        contentEl.textContent = truncated.text;

        if (truncated.isTruncated) {
          const btn = document.createElement('span');
          btn.className = 'read-more-btn';
          btn.textContent = ' Read More';
          btn.addEventListener('click', () => {
            if (btn.textContent.trim() === 'Read More') {
              contentEl.textContent = truncated.fullText;
              btn.textContent = ' Read Less';
            } else {
              contentEl.textContent = truncated.text;
              btn.textContent = ' Read More';
            }
            contentEl.appendChild(btn);
          });
          contentEl.appendChild(btn);
        }

        right.append(titleEl, subtitleEl, contentEl);

        slide.append(left, right);
        return { slide, parts: [titleEl, subtitleEl, contentEl, img] };
      }

      // Show slide at newIndex. direction = 'next' or 'prev'
      function showSlide(newIndex, direction = 'next') {
        if (animating) return;
        animating = true;

        const prevEl = currentSlideEl;
        const { slide, parts } = buildSlide(updates[newIndex]);

        // set initial classes based on direction
        if (direction === 'next') {
          slide.classList.remove('enter-from-left');
          slide.classList.add('enter-from-right');
        } else {
          slide.classList.remove('enter-from-right');
          slide.classList.add('enter-from-left');
        }
        // append new slide (on top)
        container.appendChild(slide);

        // force reflow then bring to center
        requestAnimationFrame(() => {
          slide.classList.add('current');
          slide.classList.remove('enter-from-right', 'enter-from-left');
          // previous exit animation
          if (prevEl) {
            if (direction === 'next') {
              prevEl.classList.add('exit-to-left');
            } else {
              prevEl.classList.add('exit-to-right');
            }
            // remove prev after transition
            prevEl.addEventListener('transitionend', function onEnd() {
              prevEl.removeEventListener('transitionend', onEnd);
              if (prevEl.parentElement) prevEl.parentElement.removeChild(prevEl);
            });
          }
        });

        // sequentially animate parts (faster pace)
        const partDelays = [180, 420, 700, 1000]; // ms offsets for title, subtitle, content, image
        parts.forEach((p, i) => {
          // ensure hidden initially
          p.style.opacity = 0;
          p.style.transform = 'translateY(12px)';
          setTimeout(() => p.classList.add('fade-in'), partDelays[i]);
        });

        // after slide animation complete, mark currentSlideEl and clear animating flag
        // allow same total time: transition duration ~600ms + parts (we'll wait 1.2s)
        setTimeout(() => {
          // cleanup classes
          slide.classList.remove('exit-to-left', 'exit-to-right');
          currentSlideEl = slide;
          animating = false;
        }, 1400);
      }

      function nextSlide(manual = false) {
        if (!updates.length) return;
        const newIndex = (idx + 1) % updates.length;
        showSlide(newIndex, 'next');
        idx = newIndex;
        if (manual) resetAuto();
      }

      function prevSlide(manual = false) {
        if (!updates.length) return;
        const newIndex = (idx - 1 + updates.length) % updates.length;
        showSlide(newIndex, 'prev');
        idx = newIndex;
        if (manual) resetAuto();
      }

      function startAuto() {
        stopAuto();
        autoTimer = setInterval(() => {
          if (!isPaused && !animating) nextSlide(false);
        }, AUTO_INTERVAL);
      }
      function stopAuto() { if (autoTimer) { clearInterval(autoTimer); autoTimer = null; } }
      function resetAuto() { stopAuto(); startAuto(); }

      // Pause on hover
      container.addEventListener('mouseenter', () => { isPaused = true; });
      container.addEventListener('mouseleave', () => { isPaused = false; });

      // arrow handlers
      prevBtn.addEventListener('click', () => prevSlide(true));
      nextBtn.addEventListener('click', () => nextSlide(true));

      // Fetch updates from Firestore (ensure firebase & firestore available)
      function fetchAndStart() {
        if (!(window.firebase && firebase.firestore)) {
          console.error('Firestore not found. Initialize Firebase before using updates carousel.');
          return;
        }
        firebase.firestore()
          .collection('current_updates')
          .orderBy('createdAt', 'asc')
          .get()
          .then(snapshot => {
            updates = [];
            snapshot.forEach(doc => {
              // ensure we have expected fields; fallback empty strings if missing
              const d = doc.data() || {};
              updates.push({
                title: d.title || '',
                subtitle: d.subtitle || '',
                content: d.content || '',
                image: d.image || ''
              });
            });
            if (!updates.length) {
              // show placeholder
              updates = [{
                title: 'No updates yet',
                subtitle: '',
                content: 'We will publish the latest news and CEO thoughts here soon.',
                image: ''
              }];
            }
            // initial show
            idx = 0;
            showSlide(idx, 'next');
            startAuto();
          })
          .catch(err => {
            console.error('Error fetching updates:', err);
          });
      }

      // wait a short while for firebase to be ready if needed
      if (window.firebase && firebase.firestore) {
        fetchAndStart();
      } else {
        // poll for up to 6s
        let waited = 0;
        const poll = setInterval(() => {
          if (window.firebase && firebase.firestore) {
            clearInterval(poll);
            fetchAndStart();
          } else {
            waited += 200;
            if (waited > 6000) {
              clearInterval(poll);
              console.error('Firebase not initialized. Carousel aborted.');
            }
          }
        }, 200);
      }
    })();

    // Counter animation function
    function animateCount(id, target, suffix = '') {
      const element = document.getElementById(id);
      let count = 0;
      const duration = 2000; // 2 seconds
      const stepTime = Math.max(Math.floor(duration / target), 20);

      const counter = setInterval(() => {
        count++;
        element.textContent = count.toLocaleString() + suffix;
        if (count >= target) {
          clearInterval(counter);
        }
      }, stepTime);
    }

    // Fetch stats from Firestore
    function fetchStats() {
      const statsRef = db.collection('numdata').doc('stats');

      statsRef.get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();

          // Clean numbers: remove + , and convert to integer
          const companies = parseInt(data.companies.replace(/[+,]/g, '')) || 0;
          const experience = parseInt(data.experience.replace(/[+,]/g, '')) || 0;
          const associates = parseInt(data.associates.replace(/[+,]/g, '')) || 0;

          // Animate each stat
          animateCount('clients-stat', companies, '+');
          animateCount('experience-stat', experience, '+');
          animateCount('retention-stat', associates, '+');
        } else {
          console.log("No such document!");
        }
      }).catch((error) => {
        console.log("Error getting document:", error);
      });
    }

    // Call function on load
    window.addEventListener('load', fetchStats);


    // Initialize logo carousel
    function initLogoCarousel() {
      const logos = document.querySelectorAll('.logo-item-carousel');
      let current = 0;

    }

    // Initialize everything when DOM is loaded
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize Firebase stats
      fetchStats();

      // Initialize logo carousel
      initLogoCarousel();

      (function () {
        const cards = document.querySelectorAll('.flip-card');

        // Keyboard toggle for each card
        cards.forEach(card => {
          card.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' || e.key === ' ') {
              e.preventDefault();
              card.classList.toggle('is-flipped');
              const pressed = card.classList.contains('is-flipped');
              card.setAttribute('aria-pressed', pressed.toString());
            }
          });

          // Click/tap toggles flip for touch devices (and mouse clicks)
          card.addEventListener('click', (e) => {
            // allow links inside the card to work normally
            if (e.target.closest('a')) return;
            // If device supports hover, keep hover behavior; but clicks should still work
            card.classList.toggle('is-flipped');
            const pressed = card.classList.contains('is-flipped');
            card.setAttribute('aria-pressed', pressed.toString());
          });

          // When focus leaves the card, remove flipped state so keyboard users don't leave it flipped unintentionally
          card.addEventListener('focusout', (e) => {
            // small timeout to allow focus to move to internal links/buttons
            setTimeout(() => {
              if (!card.contains(document.activeElement)) {
                card.classList.remove('is-flipped');
                card.setAttribute('aria-pressed', 'false');
              }
            }, 10);
          });
        });
      })();


      // Scroll animations
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('active');
          }
        });
      }, {
        threshold: 0.1
      });

      document.querySelectorAll('.animate-on-scroll').forEach((el) => {
        observer.observe(el);
      });

    });

    (function () {
      // Ensure Firestore (compat) or modular is present on the page.
      if (!(window.firebase && firebase.firestore)) {
        console.error('Firebase Firestore (compat) not found. Ensure you included Firebase and initialized it on the page before this script.');
        return;
      }

      // Use existing testimonialsRef if declared; otherwise create fallback
      let testimonialsRef = (typeof window.testimonialsRef !== 'undefined') ? window.testimonialsRef : null;
      if (!testimonialsRef) {
        testimonialsRef = firebase.firestore().collection('testimonials');
      }

      // Cloudinary config (unchanged)
      const cloudName = 'dhwanw6f7';
      const uploadPreset = 'psychepan_unsigned';
      const cloudinaryUrl = `https://api.cloudinary.com/v1_1/${cloudName}/upload`;

      // DOM refs
      const photoEl = document.getElementById('testimonial-photo');
      const nameEl = document.getElementById('testimonial-name');
      const roleEl = document.getElementById('testimonial-role');
      const textEl = document.getElementById('testimonial-text');
      const starsEl = document.getElementById('testimonial-stars');
      const prevBtn = document.getElementById('prev-btn');
      const nextBtn = document.getElementById('next-btn');
      const counterEl = document.getElementById('testimonial-counter');
      const gridEl = document.getElementById('testimonials-grid');

      const addBtn = document.getElementById('addReviewBtn');
      const modal = document.getElementById('reviewModal');
      const modalClose = document.getElementById('modalClose');
      const modalCancel = document.getElementById('modalCancel');
      const reviewForm = document.getElementById('reviewForm');
      const formMsg = document.getElementById('formMsg');

      const rName = document.getElementById('r-name');
      const rRole = document.getElementById('r-role');
      const rPhoto = document.getElementById('r-photo');
      const rPhotoFile = document.getElementById('r-photo-file');
      const rRating = document.getElementById('r-rating');
      const rText = document.getElementById('r-text');

      let testimonials = []; // full set (most recent first)
      let currentIndex = 0;

      const DEFAULT_AVATAR = 'https://www.gravatar.com/avatar/?d=mp&s=160';

      // Utility: safe HTML escape
      function escapeHtml(str) {
        if (!str && str !== 0) return '';
        return String(str)
          .replaceAll('&', '&amp;')
          .replaceAll('<', '&lt;')
          .replaceAll('>', '&gt;')
          .replaceAll('"', '&quot;')
          .replaceAll("'", '&#39;');
      }

      // Render stars
      function renderStars(container, rating) {
        container.innerHTML = '';
        rating = Math.max(0, Math.min(5, parseInt(rating || 0, 10)));
        for (let i = 1; i <= 5; i++) {
          const span = document.createElement('span');
          span.className = 'text-lg mr-1';
          span.textContent = i <= rating ? '⭐' : '☆';
          container.appendChild(span);
        }
      }

      // Try to load an image URL into an <img> element with fallbacks for HEIC & Cloudinary
      // Returns a Promise that resolves to the final used URL (or DEFAULT_AVATAR)
      function tryLoadImage(url, imgEl) {
        return new Promise(resolve => {
          if (!url) {
            imgEl.src = DEFAULT_AVATAR;
            resolve(DEFAULT_AVATAR);
            return;
          }

          let triedCloudinary = false;
          let triedHeicRename = false;
          let resolved = false;

          function setDefault() {
            if (!resolved) {
              imgEl.src = DEFAULT_AVATAR;
              resolved = true;
              resolve(DEFAULT_AVATAR);
            }
          }

          // Helper to attempt a url and wire onload/onerror
          function attempt(u, onFail) {
            const testImg = new Image();
            testImg.crossOrigin = 'anonymous';
            testImg.onload = function () {
              if (!resolved) {
                imgEl.src = u;
                resolved = true;
                resolve(u);
              }
            };
            testImg.onerror = function () {
              (onFail || setDefault)();
            };
            testImg.src = u;
          }

          // First try original
          attempt(url, function () {
            // If original fails, try cloudinary auto-format if url looks like Cloudinary
            if (!triedCloudinary && /cloudinary\.com|res\.cloudinary\.com/.test(url)) {
              triedCloudinary = true;
              // insert f_auto,q_auto after /upload/ (keeps other transformations intact)
              const newUrl = url.replace('/upload/', '/upload/f_auto,q_auto/');
              attempt(newUrl, function () {
                // if still fails, try heic->jpg rename
                if (!triedHeicRename && /\.heic(?:$|\?)/i.test(url)) {
                  triedHeicRename = true;
                  const jpgUrl = url.replace(/\.heic/i, '.jpg');
                  attempt(jpgUrl, setDefault);
                } else {
                  setDefault();
                }
              });
            } else if (!triedHeicRename && /\.heic(?:$|\?)/i.test(url)) {
              // try replacing .heic -> .jpg
              triedHeicRename = true;
              const jpgUrl = url.replace(/\.heic/i, '.jpg');
              attempt(jpgUrl, setDefault);
            } else {
              setDefault();
            }
          });
        });
      }

      // Render main large testimonial card (index wraps)
      function renderMain(i) {
        if (!testimonials.length) {
          photoEl.src = DEFAULT_AVATAR;
          photoEl.alt = 'No reviews';
          nameEl.textContent = 'No reviews yet';
          roleEl.textContent = '';
          textEl.textContent = 'Be the first to add a review.';
          starsEl.innerHTML = '';
          counterEl.textContent = '0 of 0';
          return;
        }
        i = ((i % testimonials.length) + testimonials.length) % testimonials.length; // wrap
        currentIndex = i;
        const t = testimonials[i];

        // load image with fallbacks
        tryLoadImage(t.photoURL, photoEl).then(() => {
          photoEl.alt = t.name || 'Client photo';
        });

        nameEl.textContent = t.name || 'Anonymous';
        roleEl.textContent = t.role || '';
        textEl.textContent = t.text || '';
        renderStars(starsEl, t.rating || 0);
        counterEl.textContent = `${i + 1} of ${testimonials.length}`;
      }

      // Render only the latest 3 testimonials in the grid
      function renderGrid() {
        gridEl.innerHTML = '';
        const latest = testimonials.slice(0, 3); // most recent first
        latest.forEach(t => {
          const card = document.createElement('div');
          card.className = 'bg-white p-4 rounded-lg shadow-sm border border-gray-100';

          const flex = document.createElement('div');
          flex.className = 'flex items-center gap-3 mb-3';

          const img = document.createElement('img');
          img.className = 'w-12 h-12 rounded-full object-cover';
          img.alt = t.name || 'Anonymous';
          // start with a fallback; will be replaced if load succeeds
          img.src = DEFAULT_AVATAR;

          // attempt to load real image
          tryLoadImage(t.photoURL, img).catch(() => {
            img.src = DEFAULT_AVATAR;
          });

          const meta = document.createElement('div');
          const title = document.createElement('div');
          title.className = 'font-semibold text-sm';
          title.textContent = t.name || 'Anonymous';
          const sub = document.createElement('div');
          sub.className = 'text-xs text-gray-500';
          sub.textContent = t.role || '';

          meta.appendChild(title);
          meta.appendChild(sub);
          flex.appendChild(img);
          flex.appendChild(meta);

          const quote = document.createElement('div');
          quote.className = 'text-sm text-gray-700 mb-2 italic';
          quote.textContent = `"${t.text || ''}"`;

          const stars = document.createElement('div');
          stars.className = 'text-sm text-yellow-500';
          const r = Math.max(0, Math.min(5, parseInt(t.rating || 0, 10)));
          stars.textContent = '★'.repeat(r) + '☆'.repeat(5 - r);

          card.appendChild(flex);
          card.appendChild(quote);
          card.appendChild(stars);

          gridEl.appendChild(card);
        });
      }

      // Firestore live listener
      function subscribeToTestimonials() {
        try {
          testimonialsRef.orderBy('createdAt', 'desc').onSnapshot(snapshot => {
            const docs = [];
            snapshot.forEach(doc => {
              const data = doc.data();
              docs.push({
                id: doc.id,
                name: data.name || '',
                role: data.role || '',
                photoURL: data.photoURL || '',
                rating: data.rating || 0,
                text: data.text || '',
                createdAt: data.createdAt ? (data.createdAt.toMillis ? data.createdAt.toMillis() : (data.createdAt.seconds ? data.createdAt.seconds * 1000 : null)) : null
              });
            });

            testimonials = docs; // most recent first (desc)
            // render latest 3 in grid
            renderGrid();
            // adjust current index if needed
            if (!testimonials.length) {
              renderMain(0);
            } else {
              if (currentIndex >= testimonials.length) currentIndex = 0;
              renderMain(currentIndex);
            }
          }, err => {
            console.error('Error listening to testimonials:', err);
          });
        } catch (err) {
          console.error('Error subscribing to testimonials. Make sure testimonialsRef is a valid collection reference.', err);
        }
      }

      // Add testimonial (same as before)
      function addTestimonial(payload) {
        const doc = {
          name: payload.name || '',
          role: payload.role || '',
          photoURL: payload.photoURL || '',
          rating: parseInt(payload.rating || 0, 10),
          text: payload.text || '',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        return testimonialsRef.add(doc);
      }

      // Upload to Cloudinary (unchanged)
      async function uploadImageToCloudinary(file) {
        if (!file) return null;
        const fd = new FormData();
        fd.append('upload_preset', uploadPreset);
        fd.append('file', file);
        try {
          const res = await fetch(cloudinaryUrl, { method: 'POST', body: fd });
          if (!res.ok) {
            const txt = await res.text();
            throw new Error('Cloudinary upload failed: ' + txt);
          }
          const data = await res.json();
          return data.secure_url || data.url || null;
        } catch (err) {
          console.error('Cloudinary upload error:', err);
          return null;
        }
      }

      // Modal helpers (same)
      function openModal() {
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        rName.focus();
      }
      function closeModal() {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
        formMsg.classList.add('hidden');
        formMsg.textContent = '';
        reviewForm.reset();
      }

      // prev/next behavior uses full testimonials array
      prevBtn.addEventListener('click', (e) => {
        if (!testimonials.length) return;
        renderMain(currentIndex - 1);
      });
      nextBtn.addEventListener('click', (e) => {
        if (!testimonials.length) return;
        renderMain(currentIndex + 1);
      });

      // Modal open/close
      addBtn.addEventListener('click', openModal);
      modalClose.addEventListener('click', closeModal);
      modalCancel.addEventListener('click', closeModal);
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });

      // Submit handler (uploads file if given, then adds doc)
      reviewForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const payload = {
          name: (rName.value || '').trim(),
          role: (rRole.value || '').trim(),
          photoURL: (rPhoto.value || '').trim(),
          rating: parseInt(rRating.value || '5', 10),
          text: (rText.value || '').trim()
        };

        if (!payload.name || !payload.text) {
          formMsg.classList.remove('hidden');
          formMsg.classList.remove('text-green-600');
          formMsg.classList.add('text-red-600');
          formMsg.textContent = 'Please add your name and review text.';
          return;
        }

        const submitBtn = document.getElementById('modalSubmit');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';

        try {
          const file = rPhotoFile && rPhotoFile.files && rPhotoFile.files[0] ? rPhotoFile.files[0] : null;
          if (file) {
            formMsg.classList.remove('hidden');
            formMsg.classList.remove('text-red-600');
            formMsg.classList.add('text-gray-600');
            formMsg.textContent = 'Uploading image...';
            const uploadedUrl = await uploadImageToCloudinary(file);
            if (uploadedUrl) payload.photoURL = uploadedUrl;
            else {
              formMsg.classList.remove('text-gray-600');
              formMsg.classList.add('text-red-600');
              formMsg.textContent = 'Image upload failed — proceeding with provided URL (if any).';
            }
          }

          await addTestimonial(payload);

          formMsg.classList.remove('text-red-600');
          formMsg.classList.add('text-green-600');
          formMsg.classList.remove('hidden');
          formMsg.textContent = 'Thanks — your review has been submitted!';

          setTimeout(() => {
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Review';
            closeModal();
          }, 900);

        } catch (err) {
          console.error('Error adding testimonial:', err);
          formMsg.classList.remove('hidden');
          formMsg.classList.remove('text-green-600');
          formMsg.classList.add('text-red-600');
          formMsg.textContent = 'Failed to submit — please try again later.';
          submitBtn.disabled = false;
          submitBtn.textContent = 'Submit Review';
        }
      });

      // Initialize
      renderMain(0);
      renderGrid();
      subscribeToTestimonials();

    })();
  </script>

</body>

</html>